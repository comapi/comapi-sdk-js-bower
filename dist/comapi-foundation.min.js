var COMAPI=function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={exports:{},id:d,loaded:!1};return a[d].call(e.exports,e,e.exports,b),e.loaded=!0,e.exports}var c={};return b.m=a,b.c=c,b.p="",b(0)}([function(a,b,c){c(1),a.exports=c(3)},function(a,b,c){(function(a,b){var c;!function(c){"use strict";function d(a,b,c,d){if(y(c)){if(!H(a))throw new TypeError;if(!J(b))throw new TypeError;return n(a,b)}if(!H(a))throw new TypeError;if(!B(b))throw new TypeError;if(!B(d)&&!y(d)&&!z(d))throw new TypeError;return z(d)&&(d=void 0),c=G(c),o(a,b,c,d)}function e(a,b){function c(c,d){if(!B(c))throw new TypeError;if(!y(d)&&!K(d))throw new TypeError;u(a,b,c,d)}return c}function f(a,b,c,d){if(!B(c))throw new TypeError;return y(d)||(d=G(d)),u(a,b,c,d)}function g(a,b,c){if(!B(b))throw new TypeError;return y(c)||(c=G(c)),q(a,b,c)}function h(a,b,c){if(!B(b))throw new TypeError;return y(c)||(c=G(c)),r(a,b,c)}function i(a,b,c){if(!B(b))throw new TypeError;return y(c)||(c=G(c)),s(a,b,c)}function j(a,b,c){if(!B(b))throw new TypeError;return y(c)||(c=G(c)),t(a,b,c)}function k(a,b){if(!B(a))throw new TypeError;return y(b)||(b=G(b)),v(a,b)}function l(a,b){if(!B(a))throw new TypeError;return y(b)||(b=G(b)),w(a,b)}function m(a,b,c){if(!B(b))throw new TypeError;y(c)||(c=G(c));var d=p(b,c,!1);if(y(d))return!1;if(!d.delete(a))return!1;if(d.size>0)return!0;var e=aa.get(b);return e.delete(c),e.size>0||(aa.delete(b),!0)}function n(a,b){for(var c=a.length-1;c>=0;--c){var d=a[c],e=d(b);if(!y(e)&&!z(e)){if(!J(e))throw new TypeError;b=e}}return b}function o(a,b,c,d){for(var e=a.length-1;e>=0;--e){var f=a[e],g=f(b,c,d);if(!y(g)&&!z(g)){if(!B(g))throw new TypeError;d=g}}return d}function p(a,b,c){var d=aa.get(a);if(y(d)){if(!c)return;d=new Z,aa.set(a,d)}var e=d.get(b);if(y(e)){if(!c)return;e=new Z,d.set(b,e)}return e}function q(a,b,c){if(r(a,b,c))return!0;var d=Q(b);return!z(d)&&q(a,d,c)}function r(a,b,c){var d=p(b,c,!1);return!y(d)&&E(d.has(a))}function s(a,b,c){if(r(a,b,c))return t(a,b,c);var d=Q(b);return z(d)?void 0:s(a,d,c)}function t(a,b,c){var d=p(b,c,!1);if(!y(d))return d.get(a)}function u(a,b,c,d){p(c,d,!0).set(a,b)}function v(a,b){var c=w(a,b),d=Q(a);if(null===d)return c;var e=v(d,b);if(e.length<=0)return c;if(c.length<=0)return e;for(var f=new $,g=[],h=0,i=c;h<i.length;h++){var j=i[h],k=f.has(j);k||(f.add(j),g.push(j))}for(var l=0,m=e;l<m.length;l++){var j=m[l],k=f.has(j);k||(f.add(j),g.push(j))}return g}function w(a,b){var c=[],d=p(a,b,!1);if(y(d))return c;for(var e=d.keys(),f=M(e),g=0;;){var h=O(f);if(!h)return c.length=g,c;var i=N(h);try{c[g]=i}catch(a){try{P(f)}finally{throw a}}g++}}function x(a){if(null===a)return 1;switch(typeof a){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===a?1:6;default:return 6}}function y(a){return void 0===a}function z(a){return null===a}function A(a){return"symbol"==typeof a}function B(a){return"object"==typeof a?null!==a:"function"==typeof a}function C(a,b){switch(x(a)){case 0:case 1:case 2:case 3:case 4:case 5:return a}var c=3===b?"string":5===b?"number":"default",d=L(a,V);if(void 0!==d){var e=d.call(a,c);if(B(e))throw new TypeError;return e}return D(a,"default"===c?"number":c)}function D(a,b){if("string"===b){var c=a.toString;if(I(c)){var d=c.call(a);if(!B(d))return d}var e=a.valueOf;if(I(e)){var d=e.call(a);if(!B(d))return d}}else{var e=a.valueOf;if(I(e)){var d=e.call(a);if(!B(d))return d}var f=a.toString;if(I(f)){var d=f.call(a);if(!B(d))return d}}throw new TypeError}function E(a){return!!a}function F(a){return""+a}function G(a){var b=C(a,3);return A(b)?b:F(b)}function H(a){return Array.isArray?Array.isArray(a):a instanceof Object?a instanceof Array:"[object Array]"===Object.prototype.toString.call(a)}function I(a){return"function"==typeof a}function J(a){return"function"==typeof a}function K(a){switch(x(a)){case 3:case 4:return!0;default:return!1}}function L(a,b){var c=a[b];if(void 0!==c&&null!==c){if(!I(c))throw new TypeError;return c}}function M(a){var b=L(a,W);if(!I(b))throw new TypeError;var c=b.call(a);if(!B(c))throw new TypeError;return c}function N(a){return a.value}function O(a){var b=a.next();return!b.done&&b}function P(a){var b=a.return;b&&b.call(a)}function Q(a){var b=Object.getPrototypeOf(a);if("function"!=typeof a||a===X)return b;if(b!==X)return b;var c=a.prototype,d=c&&Object.getPrototypeOf(c);if(null==d||d===Object.prototype)return b;var e=d.constructor;return"function"!=typeof e?b:e===a?b:e}function R(a){return a.__=void 0,delete a.__,a}var S,T=Object.prototype.hasOwnProperty,U="function"==typeof Symbol,V=U&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",W=U&&void 0!==Symbol.iterator?Symbol.iterator:"@@iterator";!function(a){var b="function"==typeof Object.create,c={__proto__:[]}instanceof Array,d=!b&&!c;a.create=b?function(){return R(Object.create(null))}:c?function(){return R({__proto__:null})}:function(){return R({})},a.has=d?function(a,b){return T.call(a,b)}:function(a,b){return b in a},a.get=d?function(a,b){return T.call(a,b)?a[b]:void 0}:function(a,b){return a[b]}}(S||(S={}));var X=Object.getPrototypeOf(Function),Y="object"==typeof a&&a.env&&"true"===a.env.REFLECT_METADATA_USE_MAP_POLYFILL,Z=Y||"function"!=typeof Map||"function"!=typeof Map.prototype.entries?function(){function a(a,b){return a}function b(a,b){return b}function c(a,b){return[a,b]}var d={},e=[],f=function(){function a(a,b,c){this._index=0,this._keys=a,this._values=b,this._selector=c}return a.prototype["@@iterator"]=function(){return this},a.prototype[W]=function(){return this},a.prototype.next=function(){var a=this._index;if(a>=0&&a<this._keys.length){var b=this._selector(this._keys[a],this._values[a]);return a+1>=this._keys.length?(this._index=-1,this._keys=e,this._values=e):this._index++,{value:b,done:!1}}return{value:void 0,done:!0}},a.prototype.throw=function(a){throw this._index>=0&&(this._index=-1,this._keys=e,this._values=e),a},a.prototype.return=function(a){return this._index>=0&&(this._index=-1,this._keys=e,this._values=e),{value:a,done:!0}},a}();return function(){function e(){this._keys=[],this._values=[],this._cacheKey=d,this._cacheIndex=-2}return Object.defineProperty(e.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),e.prototype.has=function(a){return this._find(a,!1)>=0},e.prototype.get=function(a){var b=this._find(a,!1);return b>=0?this._values[b]:void 0},e.prototype.set=function(a,b){var c=this._find(a,!0);return this._values[c]=b,this},e.prototype.delete=function(a){var b=this._find(a,!1);if(b>=0){for(var c=this._keys.length,e=b+1;e<c;e++)this._keys[e-1]=this._keys[e],this._values[e-1]=this._values[e];return this._keys.length--,this._values.length--,a===this._cacheKey&&(this._cacheKey=d,this._cacheIndex=-2),!0}return!1},e.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=d,this._cacheIndex=-2},e.prototype.keys=function(){return new f(this._keys,this._values,a)},e.prototype.values=function(){return new f(this._keys,this._values,b)},e.prototype.entries=function(){return new f(this._keys,this._values,c)},e.prototype["@@iterator"]=function(){return this.entries()},e.prototype[W]=function(){return this.entries()},e.prototype._find=function(a,b){return this._cacheKey!==a&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=a)),this._cacheIndex<0&&b&&(this._cacheIndex=this._keys.length,this._keys.push(a),this._values.push(void 0)),this._cacheIndex},e}()}():Map,$=Y||"function"!=typeof Set||"function"!=typeof Set.prototype.entries?function(){return function(){function a(){this._map=new Z}return Object.defineProperty(a.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),a.prototype.has=function(a){return this._map.has(a)},a.prototype.add=function(a){return this._map.set(a,a),this},a.prototype.delete=function(a){return this._map.delete(a)},a.prototype.clear=function(){this._map.clear()},a.prototype.keys=function(){return this._map.keys()},a.prototype.values=function(){return this._map.values()},a.prototype.entries=function(){return this._map.entries()},a.prototype["@@iterator"]=function(){return this.keys()},a.prototype[W]=function(){return this.keys()},a}()}():Set,_=Y||"function"!=typeof WeakMap?function(){function a(){var a;do{a="@@WeakMap@@"+e()}while(S.has(g,a));return g[a]=!0,a}function b(a,b){if(!T.call(a,h)){if(!b)return;Object.defineProperty(a,h,{value:S.create()})}return a[h]}function c(a,b){for(var c=0;c<b;++c)a[c]=255*Math.random()|0;return a}function d(a){return"function"==typeof Uint8Array?"undefined"!=typeof crypto?crypto.getRandomValues(new Uint8Array(a)):"undefined"!=typeof msCrypto?msCrypto.getRandomValues(new Uint8Array(a)):c(new Uint8Array(a),a):c(new Array(a),a)}function e(){var a=d(f);a[6]=79&a[6]|64,a[8]=191&a[8]|128;for(var b="",c=0;c<f;++c){var e=a[c];4!==c&&6!==c&&8!==c||(b+="-"),e<16&&(b+="0"),b+=e.toString(16).toLowerCase()}return b}var f=16,g=S.create(),h=a();return function(){function c(){this._key=a()}return c.prototype.has=function(a){var c=b(a,!1);return void 0!==c&&S.has(c,this._key)},c.prototype.get=function(a){var c=b(a,!1);return void 0!==c?S.get(c,this._key):void 0},c.prototype.set=function(a,c){return b(a,!0)[this._key]=c,this},c.prototype.delete=function(a){var c=b(a,!1);return void 0!==c&&delete c[this._key]},c.prototype.clear=function(){this._key=a()},c}()}():WeakMap,aa=new _;c.decorate=d,c.metadata=e,c.defineMetadata=f,c.hasMetadata=g,c.hasOwnMetadata=h,c.getMetadata=i,c.getOwnMetadata=j,c.getMetadataKeys=k,c.getOwnMetadataKeys=l,c.deleteMetadata=m,function(a){if(void 0!==a.Reflect){if(a.Reflect!==c)for(var b in c)T.call(c,b)&&(a.Reflect[b]=c[b])}else a.Reflect=c}(void 0!==b?b:"undefined"!=typeof self?self:Function("return this;")())}(c||(c={}))}).call(b,c(2),function(){return this}())},function(a,b){function c(){throw new Error("setTimeout has not been defined")}function d(){throw new Error("clearTimeout has not been defined")}function e(a){if(k===setTimeout)return setTimeout(a,0);if((k===c||!k)&&setTimeout)return k=setTimeout,setTimeout(a,0);try{return k(a,0)}catch(b){try{return k.call(null,a,0)}catch(b){return k.call(this,a,0)}}}function f(a){if(l===clearTimeout)return clearTimeout(a);if((l===d||!l)&&clearTimeout)return l=clearTimeout,clearTimeout(a);try{return l(a)}catch(b){try{return l.call(null,a)}catch(b){return l.call(this,a)}}}function g(){p&&n&&(p=!1,n.length?o=n.concat(o):q=-1,o.length&&h())}function h(){if(!p){var a=e(g);p=!0;for(var b=o.length;b;){for(n=o,o=[];++q<b;)n&&n[q].run();q=-1,b=o.length}n=null,p=!1,f(a)}}function i(a,b){this.fun=a,this.array=b}function j(){}var k,l,m=a.exports={};!function(){try{k="function"==typeof setTimeout?setTimeout:c}catch(a){k=c}try{l="function"==typeof clearTimeout?clearTimeout:d}catch(a){l=d}}();var n,o=[],p=!1,q=-1;m.nextTick=function(a){var b=new Array(arguments.length-1);if(arguments.length>1)for(var c=1;c<arguments.length;c++)b[c-1]=arguments[c];o.push(new i(a,b)),1!==o.length||p||e(h)},i.prototype.run=function(){this.fun.apply(null,this.array)},m.title="browser",m.browser=!0,m.env={},m.argv=[],m.version="",m.versions={},m.on=j,m.addListener=j,m.once=j,m.off=j,m.removeListener=j,m.removeAllListeners=j,m.emit=j,m.prependListener=j,m.prependOnceListener=j,m.listeners=function(a){return[]},m.binding=function(a){throw new Error("process.binding is not supported")},m.cwd=function(){return"/"},m.chdir=function(a){throw new Error("process.chdir is not supported")},m.umask=function(){return 0}},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c(4),e=c(5);b.ConversationBuilder=e.ConversationBuilder;var f=c(7);b.MessageBuilder=f.MessageBuilder;var g=c(8);b.MessageStatusBuilder=g.MessageStatusBuilder;var h=c(9);b.ComapiConfig=h.ComapiConfig;var i=c(10),j=c(11),k=c(12),l=c(77);b.ContentData=l.ContentData;var m=function(){function a(a,b,c,d,e,f){this._eventManager=a,this._logger=b,this._networkManager=c,this._services=d,this._device=e,this._channels=f}return a.initialiseShared=function(b){return a._initialise(b,!0)},a.initialise=function(b){return a._initialise(b,!1)},Object.defineProperty(a,"version",{get:function(){return"1.0.2.121"},enumerable:!0,configurable:!0}),a._initialise=function(b,c){if(c&&a._foundation)return Promise.resolve(a._foundation);void 0===b.foundationRestUrls&&(b.foundationRestUrls=new i.FoundationRestUrls);var e=b.interfaceContainer?b.interfaceContainer:new k.InterfaceContainer;b.interfaceContainer?e=b.interfaceContainer:(e=new k.InterfaceContainer,e.initialise(b),e.bindComapiConfig(b)),b.logPersistence&&b.logPersistence===d.LogPersistences.IndexedDB&&e.bindIndexedDBLogger();var f=e.getInterface(j.INTERFACE_SYMBOLS.EventManager),g=e.getInterface(j.INTERFACE_SYMBOLS.Logger);b.logLevel&&(g.logLevel=b.logLevel);var h=e.getInterface(j.INTERFACE_SYMBOLS.NetworkManager),l=e.getInterface(j.INTERFACE_SYMBOLS.Services),m=e.getInterface(j.INTERFACE_SYMBOLS.Device),n=e.getInterface(j.INTERFACE_SYMBOLS.Channels),o=new a(f,g,h,l,m,n);return c&&(a._foundation=o),Promise.resolve(o)},a.prototype.startSession=function(){return this._networkManager.startSession().then(function(a){return a.session})},a.prototype.endSession=function(){return this._networkManager.endSession()},Object.defineProperty(a.prototype,"services",{get:function(){return this._services},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"device",{get:function(){return this._device},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"channels",{get:function(){return this._channels},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"session",{get:function(){return this._networkManager.session},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"logger",{get:function(){return this._logger},enumerable:!0,configurable:!0}),a.prototype.on=function(a,b){this._eventManager.subscribeToLocalEvent(a,b)},a.prototype.off=function(a,b){this._eventManager.unsubscribeFromLocalEvent(a,b)},a.prototype.getLogs=function(){return this._logger.getLog()},a}();b.Foundation=m},function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0});!function(a){a[a.None=0]="None",a[a.Error=1]="Error",a[a.Warn=2]="Warn",a[a.Debug=3]="Debug"}(b.LogLevels||(b.LogLevels={}));!function(a){a[a.None=0]="None",a[a.IndexedDB=1]="IndexedDB",a[a.LocalStorage=2]="LocalStorage"}(b.LogPersistences||(b.LogPersistences={}));!function(a){a[a.None=0]="None",a[a.IndexedDbIfSupported=1]="IndexedDbIfSupported",a[a.LocalStorage=2]="LocalStorage"}(b.OrphanedEventPersistences||(b.OrphanedEventPersistences={}));!function(a){a[a.development=0]="development",a[a.production=1]="production"}(b.Environment||(b.Environment={}));!function(a){a[a.public=0]="public",a[a.participant=1]="participant"}(b.ConversationScope||(b.ConversationScope={}))},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c(6),e=function(){function a(){this.description=void 0,this.roles={owner:{canSend:!0,canAddParticipants:!0,canRemoveParticipants:!0},participant:{canSend:!0,canAddParticipants:!0,canRemoveParticipants:!0}},this.isPublic=!1,this.participants=void 0,this.id=d.Utils.uuid()}return a.prototype.withId=function(a){return this.id=a,this},a.prototype.withName=function(a){return this.name=a,this},a.prototype.withDescription=function(a){return this.description=a,this},a.prototype.withUsers=function(a){this.participants=[];for(var b=0,c=a;b<c.length;b++){var d=c[b];this.participants.push({id:d})}return this},a.prototype.withUser=function(a){return this.participants=[{id:a}],this},a.prototype.withParticipants=function(a){return this.participants=a,this},a.prototype.withOwnerPrivelages=function(a){return this.roles.owner=a,this},a.prototype.withParticipantPrivelages=function(a){return this.roles.participant=a,this},a}();b.ConversationBuilder=e},function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var c=function(){function a(){throw new Error("Cannot new this class")}return a.clone=function(a){return JSON.parse(JSON.stringify(a))},a.uuid=function(){var a=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(b){var c=(a+16*Math.random())%16|0;return a=Math.floor(a/16),("x"===b?c:3&c|8).toString(16)})},a.getBrowserInfo=function(a){var b,c=void 0!==a?a:navigator.userAgent,d=c.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(d[1])?(b=/\brv[ :]+(\d+)/g.exec(c)||[],{name:"IE",version:b[1]||""}):"Chrome"===d[1]&&null!==(b=c.match(/\bOPR\/(\d+)/))?{name:"Opera",version:b[1]}:(d=d[2]?[d[1],d[2]]:[navigator.appName,navigator.appVersion,"-?"],b=c.match(/version\/(\d+)/i),null!==b&&d.splice(1,1,b[1]),{name:d[0],version:d[1]})},a.eachSeries=function(a,b){return a.reduce(function(a,c){return a.then(function(){return b(c)})},Promise.resolve())},a.doUntil=function(b,c,d){return b(d).then(function(d){return c(d)?a.doUntil(b,c,d):d})},a.format=function(a,b){return a.replace(/{{(.*?)}}/g,function(a,c){var d;return"string"==typeof b[c]&&(d="urlBase"!==c?encodeURIComponent(b[c]):b[c]),"string"==typeof d?d:""})},a.getHeaderValue=function(a,b){return a[b]||a[b.toLowerCase()]},a}();b.Utils=c},function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var c=function(){function a(){this.id=void 0,this.metadata={},this.parts=[],this.alert=void 0,this.context=void 0,this.sentEventId=void 0,this.statusUpdates=void 0}return a.prototype.withText=function(a){return this.parts.push({data:a,size:a.length,type:"text/plain"}),this},a.prototype.withData=function(a,b){return this.parts.push({data:b,size:b.length,type:a}),this},a.prototype.withURL=function(a,b,c,d){return this.parts.push({name:d,size:c,type:a,url:b}),this},a.prototype.withPart=function(a){return this.parts.push(a),this},a.prototype.withPush=function(a){return this.alert={text:a,platforms:{apns:void 0,fcm:void 0}},this},a.prototype.withApnsAlert=function(a){return this.alert.platforms.apns=a,this},a.prototype.withFcmAlert=function(a){return this.alert.platforms.fcm=a,this},a.prototype.withMetadata=function(a){return this.metadata=a,this},a}();b.MessageBuilder=c},function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var c=function(){function a(){}return a.prototype.deliveredStatusUpdate=function(a){return{messageIds:[a],status:"delivered",timestamp:(new Date).toISOString()}},a.prototype.deliveredStatusUpdates=function(a){return{messageIds:a,status:"delivered",timestamp:(new Date).toISOString()}},a.prototype.readStatusUpdate=function(a){return{messageIds:[a],status:"read",timestamp:(new Date).toISOString()}},a.prototype.readStatusUpdates=function(a){return{messageIds:a,status:"read",timestamp:(new Date).toISOString()}},a}();b.MessageStatusBuilder=c},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c(4),e=c(10),f=function(){function a(){this.logRetentionHours=24,this.urlBase="https://api.comapi.com",this.webSocketBase="wss://api.comapi.com",this.logLevel=d.LogLevels.Error,this.logPersistence=d.LogPersistences.LocalStorage,this.isTypingTimeout=10,this.isTypingOffTimeout=10,this.foundationRestUrls=new e.FoundationRestUrls,this.orphanedEventPersistence=d.OrphanedEventPersistences.IndexedDbIfSupported,this.apiSpaceId=void 0}return a.prototype.withApiSpace=function(a){return this.apiSpaceId=a,this},a.prototype.withLogRetentionTime=function(a){return this.logRetentionHours=a,this},a.prototype.withAuthChallenge=function(a){return this.authChallenge=a,this},a.prototype.withUrlBase=function(a){return this.urlBase=a,this},a.prototype.withWebSocketBase=function(a){return this.webSocketBase=a,this},a.prototype.withLogLevel=function(a){return this.logLevel=a,this},a.prototype.withLogPersistence=function(a){return this.logPersistence=a,this},a.prototype.withFoundationRestUrls=function(a){return this.foundationRestUrls=a,this},a.prototype.withEventMapping=function(a){return this.eventMapping=a,this},a.prototype.withLocalStoragePrefix=function(a){return this.localStoragePrefix=a,this},a.prototype.withOrphanedEventPersistence=function(a){return this.orphanedEventPersistence=a,this},a}();b.ComapiConfig=f},function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var c=function(){function a(){this.content="{{urlBase}}/apispaces/{{apiSpaceId}}/content",this.conversations="{{urlBase}}/apispaces/{{apiSpaceId}}/conversations",this.conversation="{{urlBase}}/apispaces/{{apiSpaceId}}/conversations/{{conversationId}}",this.participants="{{urlBase}}/apispaces/{{apiSpaceId}}/conversations/{{conversationId}}/participants",this.typing="{{urlBase}}/apispaces/{{apiSpaceId}}/conversations/{{conversationId}}/typing",this.push="{{urlBase}}/apispaces/{{apiSpaceId}}/sessions/{{sessionId}}/push",this.facebook="{{urlBase}}/apispaces/{{apiSpaceId}}/channels/facebook/state",this.events="{{urlBase}}/apispaces/{{apiSpaceId}}/conversations/{{conversationId}}/events",this.messages="{{urlBase}}/apispaces/{{apiSpaceId}}/conversations/{{conversationId}}/messages",this.statusUpdates="{{urlBase}}/apispaces/{{apiSpaceId}}/conversations/{{conversationId}}/messages/statusupdates",this.profiles="{{urlBase}}/apispaces/{{apiSpaceId}}/profiles",this.profile="{{urlBase}}/apispaces/{{apiSpaceId}}/profiles/{{profileId}}",this.sessions="{{urlBase}}/apispaces/{{apiSpaceId}}/sessions",this.sessionStart="{{urlBase}}/apispaces/{{apiSpaceId}}/sessions/start",this.session="{{urlBase}}/apispaces/{{apiSpaceId}}/sessions/{{sessionId}}"}return a}();b.FoundationRestUrls=c},function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var c={AppMessaging:"AppMessaging",AuthenticatedRestClient:"AuthenticatedRestClient",Channels:"Channels",ComapiConfig:"ComapiConfig",ContentManager:"ContentManager",ConversationManager:"ConversationManager",Device:"Device",DeviceManager:"DeviceManager",EventManager:"EventManager",EventMapper:"EventMapper",FacebookManager:"FacebookManager",IndexedDBLogger:"IndexedDBLogger",LocalStorageData:"LocalStorageData",Logger:"Logger",MessageManager:"MessageManager",MessagePager:"MessagePager",NetworkManager:"NetworkManager",OrphanedEventManager:"OrphanedEventManager",Profile:"Profile",ProfileManager:"ProfileManager",RestClient:"RestClient",Services:"Services",SessionManager:"SessionManager",WebSocketManager:"WebSocketManager"};b.INTERFACE_SYMBOLS=c},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),c(1);var d=c(13),e=c(4),f=c(52),g=c(53),h=c(54),i=c(57),j=c(58),k=c(59),l=c(60),m=c(61),n=c(62),o=c(63),p=c(64),q=c(65),r=c(66),s=c(67),t=c(68),u=c(69),v=c(70),w=c(71),x=c(72),y=c(73),z=c(74),A=c(55),B=c(75),C=c(76),D=c(11),E=function(){function a(){this._overriddenInterfaces={},this._container=new d.Container}return a.prototype.initialise=function(a){this._container.bind(D.INTERFACE_SYMBOLS.EventManager).to(f.EventManager).inSingletonScope(),this._container.bind(D.INTERFACE_SYMBOLS.LocalStorageData).to(g.LocalStorageData).inSingletonScope(),this._container.bind(D.INTERFACE_SYMBOLS.Logger).to(h.Logger).inSingletonScope(),this._container.bind(D.INTERFACE_SYMBOLS.RestClient).to(i.RestClient).inSingletonScope(),this._container.bind(D.INTERFACE_SYMBOLS.SessionManager).to(k.SessionManager).inSingletonScope(),this._container.bind(D.INTERFACE_SYMBOLS.EventMapper).to(B.EventMapper).inSingletonScope(),this._container.bind(D.INTERFACE_SYMBOLS.WebSocketManager).to(l.WebSocketManager).inSingletonScope(),this._container.bind(D.INTERFACE_SYMBOLS.NetworkManager).to(m.NetworkManager).inSingletonScope(),this._container.bind(D.INTERFACE_SYMBOLS.AuthenticatedRestClient).to(j.AuthenticatedRestClient).inSingletonScope(),this._container.bind(D.INTERFACE_SYMBOLS.DeviceManager).to(n.DeviceManager).inSingletonScope(),this._container.bind(D.INTERFACE_SYMBOLS.FacebookManager).to(o.FacebookManager).inSingletonScope(),this._container.bind(D.INTERFACE_SYMBOLS.ConversationManager).to(p.ConversationManager).inSingletonScope(),this._container.bind(D.INTERFACE_SYMBOLS.ProfileManager).to(q.ProfileManager).inSingletonScope(),this._container.bind(D.INTERFACE_SYMBOLS.MessagePager).to(u.MessagePager).inSingletonScope();var b="indexedDB"in window;a&&a.orphanedEventPersistence?a.orphanedEventPersistence===e.OrphanedEventPersistences.LocalStorage?this._container.bind(D.INTERFACE_SYMBOLS.OrphanedEventManager).to(t.LocalStorageOrphanedEventManager).inSingletonScope():a.orphanedEventPersistence===e.OrphanedEventPersistences.IndexedDbIfSupported&&(b?this._container.bind(D.INTERFACE_SYMBOLS.OrphanedEventManager).to(s.IndexedDBOrphanedEventManager).inSingletonScope():this._container.bind(D.INTERFACE_SYMBOLS.OrphanedEventManager).to(t.LocalStorageOrphanedEventManager).inSingletonScope()):b?this._container.bind(D.INTERFACE_SYMBOLS.OrphanedEventManager).to(s.IndexedDBOrphanedEventManager).inSingletonScope():this._container.bind(D.INTERFACE_SYMBOLS.OrphanedEventManager).to(t.LocalStorageOrphanedEventManager).inSingletonScope(),this._container.bind(D.INTERFACE_SYMBOLS.MessageManager).to(r.MessageManager).inSingletonScope(),this._container.bind(D.INTERFACE_SYMBOLS.AppMessaging).to(v.AppMessaging).inSingletonScope(),this._container.bind(D.INTERFACE_SYMBOLS.Profile).to(w.Profile).inSingletonScope(),this._container.bind(D.INTERFACE_SYMBOLS.Services).to(x.Services).inSingletonScope(),this._container.bind(D.INTERFACE_SYMBOLS.Device).to(y.Device).inSingletonScope(),this._container.bind(D.INTERFACE_SYMBOLS.Channels).to(z.Channels).inSingletonScope(),this._container.bind(D.INTERFACE_SYMBOLS.ContentManager).to(C.ContentManager).inSingletonScope()},a.prototype.uninitialise=function(){this._container.unbindAll()},a.prototype.bindIndexedDBLogger=function(){this._container.isBound(D.INTERFACE_SYMBOLS.IndexedDBLogger)?this._container.rebind(D.INTERFACE_SYMBOLS.IndexedDBLogger).to(A.IndexedDBLogger).inSingletonScope():this._container.bind(D.INTERFACE_SYMBOLS.IndexedDBLogger).to(A.IndexedDBLogger).inSingletonScope()},a.prototype.unbindIndexedDBLogger=function(){this._container.isBound(D.INTERFACE_SYMBOLS.IndexedDBLogger)&&this._container.unbind(D.INTERFACE_SYMBOLS.IndexedDBLogger)},a.prototype.bindComapiConfig=function(a){var b=a;this._container.isBound(D.INTERFACE_SYMBOLS.ComapiConfig)&&this._container.unbind(D.INTERFACE_SYMBOLS.ComapiConfig),this._container.bind(D.INTERFACE_SYMBOLS.ComapiConfig).toDynamicValue(function(a){return b})},a.prototype.getInterface=function(a){return this._container.get(a)},a.prototype.setInterface=function(a,b){var c=this;this._container.isBound(a)&&this._container.unbind(a),this._overriddenInterfaces[a.toString()]=b,this._container.bind(a).toDynamicValue(function(b){return c._overriddenInterfaces[a.toString()]})},a}();b.InterfaceContainer=E},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c(14);b.Container=d.Container;var e=c(42);b.ContainerModule=e.ContainerModule;var f=c(43);b.injectable=f.injectable;var g=c(44);b.tagged=g.tagged;var h=c(46);b.named=h.named;var i=c(47);b.inject=i.inject;var j=c(48);b.optional=j.optional;var k=c(49);b.unmanaged=k.unmanaged;var l=c(50);b.multiInject=l.multiInject;var m=c(51);b.targetName=m.targetName;var n=c(41);b.MetadataReader=n.MetadataReader;var o=c(16);b.guid=o.guid;var p=c(45);b.decorate=p.decorate;var q=c(39);b.traverseAncerstors=q.traverseAncerstors,b.taggedConstraint=q.taggedConstraint,b.namedConstraint=q.namedConstraint,b.typeConstraint=q.typeConstraint;var r=c(30);b.getServiceIdentifierAsString=r.getServiceIdentifierAsString},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c(15),e=c(18),f=c(20),g=c(31),h=c(33),i=c(30),j=c(40),k=c(16),l=c(19),m=c(26),n=c(17),o=c(41),p=function(){function a(a){if(void 0!==a){if("object"!=typeof a)throw new Error(""+l.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(void 0===a.defaultScope)throw new Error(""+l.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(a.defaultScope!==n.BindingScopeEnum.Singleton&&a.defaultScope!==n.BindingScopeEnum.Transient)throw new Error(""+l.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);this.options={defaultScope:a.defaultScope}}else this.options={defaultScope:n.BindingScopeEnum.Transient};this.guid=k.guid(),this._bindingDictionary=new e.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new o.MetadataReader}return a.merge=function(b,c){function d(a,b){a.traverse(function(a,c){c.forEach(function(a){b.add(a.serviceIdentifier,a.clone())})})}var e=new a,g=f.getBindingDictionary(e),h=f.getBindingDictionary(b),i=f.getBindingDictionary(c);return d(h,g),d(i,g),e},a.prototype.load=function(){for(var a=this,b=[],c=0;c<arguments.length;c++)b[c]=arguments[c];var d=function(a,b){a._binding.moduleId=b},e=function(b){return function(c){var e=a.bind.call(a,c);return d(e,b),e}},f=function(b){return function(b){a.unbind.bind(a)(b)}},g=function(b){return function(b){return a.isBound.bind(a)(b)}},h=function(b){return function(c){var e=a.rebind.call(a,c);return d(e,b),e}};b.forEach(function(a){var b=e(a.guid),c=f(a.guid),d=g(a.guid),i=h(a.guid);a.registry(b,c,d,i)})},a.prototype.unload=function(){for(var a=this,b=[],c=0;c<arguments.length;c++)b[c]=arguments[c];var d=function(a){return function(b){return b.moduleId===a}};b.forEach(function(b){var c=d(b.guid);a._bindingDictionary.removeByCondition(c)})},a.prototype.bind=function(a){var b=n.BindingScopeEnum.Transient;b=this.options.defaultScope===b?b:n.BindingScopeEnum.Singleton;var c=new d.Binding(a,b);return this._bindingDictionary.add(a,c),new h.BindingToSyntax(c)},a.prototype.rebind=function(a){return this.unbind(a),this.bind(a)},a.prototype.unbind=function(a){try{this._bindingDictionary.remove(a)}catch(b){throw new Error(l.CANNOT_UNBIND+" "+i.getServiceIdentifierAsString(a))}},a.prototype.unbindAll=function(){this._bindingDictionary=new e.Lookup},a.prototype.isBound=function(a){return this._bindingDictionary.hasKey(a)},a.prototype.isBoundNamed=function(a,b){return this.isBoundTagged(a,m.NAMED_TAG,b)},a.prototype.isBoundTagged=function(a,b,c){var d=this._bindingDictionary.get(a),e=f.createMockRequest(this,a,b,c);return d.some(function(a){return a.constraint(e)})},a.prototype.snapshot=function(){this._snapshots.push(j.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},a.prototype.restore=function(){var a=this._snapshots.pop();if(void 0===a)throw new Error(l.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=a.bindings,this._middleware=a.middleware},a.prototype.createChild=function(){var b=new a;return b.parent=this,b},a.prototype.applyMiddleware=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];var c=this._middleware?this._middleware:this._planAndResolve();this._middleware=a.reduce(function(a,b){return b(a)},c)},a.prototype.applyCustomMetadataReader=function(a){this._metadataReader=a},a.prototype.get=function(a){return this._get(!1,!1,n.TargetTypeEnum.Variable,a)},a.prototype.getTagged=function(a,b,c){return this._get(!1,!1,n.TargetTypeEnum.Variable,a,b,c)},a.prototype.getNamed=function(a,b){return this.getTagged(a,m.NAMED_TAG,b)},a.prototype.getAll=function(a){return this._get(!0,!0,n.TargetTypeEnum.Variable,a)},a.prototype.getAllTagged=function(a,b,c){return this._get(!1,!0,n.TargetTypeEnum.Variable,a,b,c)},a.prototype.getAllNamed=function(a,b){return this.getAllTagged(a,m.NAMED_TAG,b)},a.prototype.resolve=function(b){var c=new a;return c.bind(b).toSelf(),c.parent=this,c.get(b)},a.prototype._get=function(a,b,c,d,e,f){var g=null,h={avoidConstraints:a,contextInterceptor:function(a){return a},isMultiInject:b,key:e,serviceIdentifier:d,targetType:c,value:f};if(this._middleware){if(void 0===(g=this._middleware(h))||null===g)throw new Error(l.INVALID_MIDDLEWARE_RETURN)}else g=this._planAndResolve()(h);return g},a.prototype._planAndResolve=function(){var a=this;return function(b){var c=f.plan(a._metadataReader,a,b.isMultiInject,b.targetType,b.serviceIdentifier,b.key,b.value,b.avoidConstraints);return c=b.contextInterceptor(c),
g.resolve(c)}},a}();b.Container=p},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c(16),e=c(17),f=function(){function a(a,b){this.guid=d.guid(),this.activated=!1,this.serviceIdentifier=a,this.scope=b,this.type=e.BindingTypeEnum.Invalid,this.constraint=function(a){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return a.prototype.clone=function(){var b=new a(this.serviceIdentifier,this.scope);return b.activated=!1,b.implementationType=this.implementationType,b.dynamicValue=this.dynamicValue,b.scope=this.scope,b.type=this.type,b.factory=this.factory,b.provider=this.provider,b.constraint=this.constraint,b.onActivation=this.onActivation,b.cache=this.cache,b},a}();b.Binding=f},function(a,b){"use strict";function c(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}Object.defineProperty(b,"__esModule",{value:!0}),b.guid=c},function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var c={Singleton:"Singleton",Transient:"Transient"};b.BindingScopeEnum=c;var d={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};b.BindingTypeEnum=d;var e={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};b.TargetTypeEnum=e},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c(19),e=function(){function a(){this._map=new Map}return a.prototype.getMap=function(){return this._map},a.prototype.add=function(a,b){if(null===a||void 0===a)throw new Error(d.NULL_ARGUMENT);if(null===b||void 0===b)throw new Error(d.NULL_ARGUMENT);var c=this._map.get(a);void 0!==c?(c.push(b),this._map.set(a,c)):this._map.set(a,[b])},a.prototype.get=function(a){if(null===a||void 0===a)throw new Error(d.NULL_ARGUMENT);var b=this._map.get(a);if(void 0!==b)return b;throw new Error(d.KEY_NOT_FOUND)},a.prototype.remove=function(a){if(null===a||void 0===a)throw new Error(d.NULL_ARGUMENT);if(!this._map.delete(a))throw new Error(d.KEY_NOT_FOUND)},a.prototype.removeByCondition=function(a){var b=this;this._map.forEach(function(c,d){var e=c.filter(function(b){return!a(b)});e.length>0?b._map.set(d,e):b._map.delete(d)})},a.prototype.hasKey=function(a){if(null===a||void 0===a)throw new Error(d.NULL_ARGUMENT);return this._map.has(a)},a.prototype.clone=function(){var b=new a;return this._map.forEach(function(a,c){a.forEach(function(a){return b.add(c,a.clone())})}),b},a.prototype.traverse=function(a){this._map.forEach(function(b,c){a(c,b)})},a}();b.Lookup=e},function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",b.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",b.NULL_ARGUMENT="NULL argument",b.KEY_NOT_FOUND="Key Not Found",b.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",b.CANNOT_UNBIND="Could not unbind serviceIdentifier:",b.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",b.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",b.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:",b.CIRCULAR_DEPENDENCY="Circular dependency found:",b.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",b.INVALID_BINDING_TYPE="Invalid binding type:",b.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",b.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",b.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",b.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",b.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.",b.ARGUMENTS_LENGTH_MISMATCH_1="The number of constructor arguments in the derived class ",b.ARGUMENTS_LENGTH_MISMATCH_2=" must be >= than the number of constructor arguments of its base class.",b.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",b.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient')."},function(a,b,c){"use strict";function d(a){return a._bindingDictionary}function e(a,b,c,d,e,f){var g=a?t.MULTI_INJECT_TAG:t.INJECT_TAG,h=new r.Metadata(g,c),i=new o.Target(b,d,c,h);if(void 0!==e){var j=new r.Metadata(e,f);i.metadata.push(j)}return i}function f(a,b,c,d){var e=i(b.container,d.serviceIdentifier),f=[];return f=!1===a?e.filter(function(a){var e=new n.Request(a.serviceIdentifier,b,c,a,d);return a.constraint(e)}):e,g(d.serviceIdentifier,f,d,b.container),f}function g(a,b,c,d){switch(b.length){case p.BindingCount.NoBindingsAvailable:if(!0===c.isOptional())return b;var e=v.getServiceIdentifierAsString(a),f=s.NOT_REGISTERED;throw f+=v.listMetadataForTarget(e,c),f+=v.listRegisteredBindingsForServiceIdentifier(d,e,i),new Error(f);case p.BindingCount.OnlyOneBindingAvailable:if(!1===c.isArray())return b;case p.BindingCount.MultipleBindingsAvailable:default:if(!1===c.isArray()){var e=v.getServiceIdentifierAsString(a),f=s.AMBIGUOUS_MATCH+" "+e;throw f+=v.listRegisteredBindingsForServiceIdentifier(d,e,i),new Error(f)}return b}}function h(a,b,c,d,e,g){try{var i,j=void 0;if(null===e){j=f(b,d,null,g),i=new n.Request(c,d,null,j,g);var k=new l.Plan(d,i);d.addPlan(k)}else j=f(b,d,e,g),i=e.addChildRequest(g.serviceIdentifier,j,g);j.forEach(function(b){var c=null;if(c=g.isArray()?i.addChildRequest(b.serviceIdentifier,b,g):i,b.type===u.BindingTypeEnum.Instance&&null!==b.implementationType){q.getDependencies(a,b.implementationType).forEach(function(b){h(a,!1,b.serviceIdentifier,d,c,b)})}})}catch(a){if(!(a instanceof RangeError&&null!==e))throw new Error(a.message);v.circularDependencyToException(e.parentContext.plan.rootRequest)}}function i(a,b){var c=[],e=d(a);return e.hasKey(b)?c=e.get(b):null!==a.parent&&(c=i(a.parent,b)),c}function j(a,b,c,d,f,g,i,j){void 0===j&&(j=!1);var k=new m.Context(b);return h(a,j,f,k,null,e(c,d,f,"",g,i)),k}function k(a,b,c,d){var e=new o.Target(u.TargetTypeEnum.Variable,"",b,new r.Metadata(c,d)),f=new m.Context(a);return new n.Request(b,f,null,[],e)}Object.defineProperty(b,"__esModule",{value:!0});var l=c(21),m=c(22),n=c(23),o=c(24),p=c(28),q=c(29),r=c(25),s=c(19),t=c(26),u=c(17),v=c(30);b.getBindingDictionary=d,b.plan=j,b.createMockRequest=k},function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var c=function(){function a(a,b){this.parentContext=a,this.rootRequest=b}return a}();b.Plan=c},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c(16),e=function(){function a(a){this.guid=d.guid(),this.container=a}return a.prototype.addPlan=function(a){this.plan=a},a}();b.Context=e},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c(16),e=function(){function a(a,b,c,e,f){this.guid=d.guid(),this.serviceIdentifier=a,this.parentContext=b,this.parentRequest=c,this.target=f,this.childRequests=[],this.bindings=Array.isArray(e)?e:[e]}return a.prototype.addChildRequest=function(b,c,d){var e=new a(b,this.parentContext,this,c,d);return this.childRequests.push(e),e},a}();b.Request=e},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c(25),e=c(27),f=c(16),g=c(26),h=function(){function a(a,b,c,h){this.guid=f.guid(),this.type=a,this.serviceIdentifier=c,this.name=new e.QueryableString(b||""),this.metadata=new Array;var i=null;"string"==typeof h?i=new d.Metadata(g.NAMED_TAG,h):h instanceof d.Metadata&&(i=h),null!==i&&this.metadata.push(i)}return a.prototype.hasTag=function(a){for(var b=0;b<this.metadata.length;b++){if(this.metadata[b].key===a)return!0}return!1},a.prototype.isArray=function(){return this.hasTag(g.MULTI_INJECT_TAG)},a.prototype.matchesArray=function(a){return this.matchesTag(g.MULTI_INJECT_TAG)(a)},a.prototype.isNamed=function(){return this.hasTag(g.NAMED_TAG)},a.prototype.isTagged=function(){return this.metadata.some(function(a){return a.key!==g.INJECT_TAG&&a.key!==g.MULTI_INJECT_TAG&&a.key!==g.NAME_TAG&&a.key!==g.UNMANAGED_TAG&&a.key!==g.NAMED_TAG})},a.prototype.isOptional=function(){return this.matchesTag(g.OPTIONAL_TAG)(!0)},a.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(a){return a.key===g.NAMED_TAG})[0]:null},a.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(a){return a.key!==g.INJECT_TAG&&a.key!==g.MULTI_INJECT_TAG&&a.key!==g.NAME_TAG&&a.key!==g.UNMANAGED_TAG&&a.key!==g.NAMED_TAG}):null},a.prototype.matchesNamedTag=function(a){return this.matchesTag(g.NAMED_TAG)(a)},a.prototype.matchesTag=function(a){var b=this;return function(c){for(var d=0;d<b.metadata.length;d++){var e=b.metadata[d];if(e.key===a&&e.value===c)return!0}return!1}},a}();b.Target=h},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c(26),e=function(){function a(a,b){this.key=a,this.value=b}return a.prototype.toString=function(){return this.key===d.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},a}();b.Metadata=e},function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.NAMED_TAG="named",b.NAME_TAG="name",b.UNMANAGED_TAG="unmanaged",b.OPTIONAL_TAG="optional",b.INJECT_TAG="inject",b.MULTI_INJECT_TAG="multi_inject",b.TAGGED="inversify:tagged",b.TAGGED_PROP="inversify:tagged_props",b.PARAM_TYPES="inversify:paramtypes",b.DESIGN_PARAM_TYPES="design:paramtypes"},function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var c=function(){function a(a){this.str=a}return a.prototype.startsWith=function(a){return 0===this.str.indexOf(a)},a.prototype.endsWith=function(a){var b="",c=a.split("").reverse().join("");return b=this.str.split("").reverse().join(""),this.startsWith.call({str:b},c)},a.prototype.contains=function(a){return-1!==this.str.indexOf(a)},a.prototype.equals=function(a){return this.str===a},a.prototype.value=function(){return this.str},a}();b.QueryableString=c},function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var c={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};b.BindingCount=c},function(a,b,c){"use strict";function d(a,b){return e(a,k.getFunctionName(b),b,!1)}function e(a,b,c,d){var e=a.getConstructorMetadata(c),f=e.compilerGeneratedMetadata;if(void 0===f){var j=m.MISSING_INJECTABLE_ANNOTATION+" "+b+".";throw new Error(j)}var k=e.userGeneratedMetadata,l=Object.keys(k),n=0===c.length&&l.length>0,o=n?l.length:c.length,p=g(d,b,f,k,o),q=h(a,c),r=p.concat(q),s=i(a,c);if(r.length<s){var t=m.ARGUMENTS_LENGTH_MISMATCH_1+b+m.ARGUMENTS_LENGTH_MISMATCH_2;throw new Error(t)}return r}function f(a,b,c,d,e){var f=e[a.toString()]||[],g=j(f),h=!0!==g.unmanaged,i=d[a],k=g.inject||g.multiInject;if(i=k||i,!0===h){var n=i===Object,p=i===Function,q=void 0===i,r=n||p||q;if(!1===b&&r){var s=m.MISSING_INJECT_ANNOTATION+" argument "+a+" in class "+c+".";throw new Error(s)}var t=new l.Target(o.TargetTypeEnum.ConstructorArgument,g.targetName,i);return t.metadata=f,t}return null}function g(a,b,c,d,e){for(var g=[],h=0;h<e;h++){var i=h,j=f(i,a,b,c,d);null!==j&&g.push(j)}return g}function h(a,b){for(var c=a.getPropertiesMetadata(b),d=[],e=Object.keys(c),f=0;f<e.length;f++){var g=e[f],i=c[g],k=j(c[g]),m=k.targetName||g,n=k.inject||k.multiInject,p=new l.Target(o.TargetTypeEnum.ClassProperty,m,n);p.metadata=i,d.push(p)}var q=Object.getPrototypeOf(b.prototype).constructor;if(q!==Object){var r=h(a,q);d=d.concat(r)}return d}function i(a,b){var c=Object.getPrototypeOf(b.prototype).constructor;if(c!==Object){var d=k.getFunctionName(c),f=e(a,d,c,!0),g=f.map(function(a){return a.metadata.filter(function(a){return a.key===n.UNMANAGED_TAG})}),h=[].concat.apply([],g).length,j=f.length-h;return j>0?j:i(a,c)}return 0}function j(a){var b={};return a.forEach(function(a){b[a.key.toString()]=a.value}),{inject:b[n.INJECT_TAG],multiInject:b[n.MULTI_INJECT_TAG],targetName:b[n.NAME_TAG],unmanaged:b[n.UNMANAGED_TAG]}}Object.defineProperty(b,"__esModule",{value:!0});var k=c(30),l=c(24),m=c(19),n=c(26),o=c(17);b.getDependencies=d},function(a,b,c){"use strict";function d(a){if("function"==typeof a){var b=a;return b.name}if("symbol"==typeof a)return a.toString();var b=a;return b}function e(a,b,c){var d="",e=c(a,b);return 0!==e.length&&(d="\nRegistered bindings:",e.forEach(function(a){var b="Object";null!==a.implementationType&&(b=h(a.implementationType)),d=d+"\n "+b,a.constraint.metaData&&(d=d+" - "+a.constraint.metaData)})),d}function f(a,b){void 0===b&&(b=[]);var c=d(a.serviceIdentifier);b.push(c),a.childRequests.forEach(function(a){var c=d(a.serviceIdentifier);if(-1!==b.indexOf(c)){b.push(c);var e=b.reduce(function(a,b){return""!==a?a+" -> "+b:""+b},"");throw new Error(i.CIRCULAR_DEPENDENCY+" "+e)}a.childRequests.length>0?f(a,b):b.push(c)})}function g(a,b){if(b.isTagged()||b.isNamed()){var c="",d=b.getNamedTag(),e=b.getCustomTags();return null!==d&&(c+=d.toString()+"\n"),null!==e&&e.forEach(function(a){c+=a.toString()+"\n"})," "+a+"\n "+a+" - "+c}return" "+a}function h(a){if(a.name)return a.name;var b=a.toString(),c=b.match(/^function\s*([^\s(]+)/);return c?c[1]:"Anonymous function: "+b}Object.defineProperty(b,"__esModule",{value:!0});var i=c(19);b.getServiceIdentifierAsString=d,b.listRegisteredBindingsForServiceIdentifier=e,b.circularDependencyToException=f,b.listMetadataForTarget=g,b.getFunctionName=h},function(a,b,c){"use strict";function d(a){var b=a.bindings,c=a.childRequests,e=a.target&&a.target.isArray(),j=!(a.parentRequest&&a.parentRequest.target&&a.target&&a.parentRequest.target.matchesArray(a.target.serviceIdentifier));if(e&&j)return c.map(function(a){return d(a)});var k=null;if(!0!==a.target.isOptional()||0!==b.length){var l=b[0],m=l.scope===f.BindingScopeEnum.Singleton;if(m&&!0===l.activated)return l.cache;if(l.type===f.BindingTypeEnum.ConstantValue)k=l.cache;else if(l.type===f.BindingTypeEnum.Function)k=l.cache;else if(l.type===f.BindingTypeEnum.Constructor)k=l.implementationType;else if(l.type===f.BindingTypeEnum.DynamicValue&&null!==l.dynamicValue)k=l.dynamicValue(a.parentContext);else if(l.type===f.BindingTypeEnum.Factory&&null!==l.factory)k=l.factory(a.parentContext);else if(l.type===f.BindingTypeEnum.Provider&&null!==l.provider)k=l.provider(a.parentContext);else{if(l.type!==f.BindingTypeEnum.Instance||null===l.implementationType){var n=g.getServiceIdentifierAsString(a.serviceIdentifier);throw new Error(i.INVALID_BINDING_TYPE+" "+n)}k=h.resolveInstance(l.implementationType,c,d)}return"function"==typeof l.onActivation&&(k=l.onActivation(a.parentContext,k)),m&&(l.cache=k,l.activated=!0),k}}function e(a){return d(a.plan.rootRequest)}Object.defineProperty(b,"__esModule",{value:!0});var f=c(17),g=c(30),h=c(32),i=c(19);b.resolve=e},function(a,b,c){"use strict";function d(a,b,c){var d=b.filter(function(a){return null!==a.target&&a.target.type===g.TargetTypeEnum.ClassProperty}),e=d.map(function(a){return c(a)});return d.forEach(function(b,c){var d="";d=b.target.name.value();var f=e[c];a[d]=f}),a}function e(a,b){return new(a.bind.apply(a,[void 0].concat(b)))}function f(a,b,c){var f=null;if(b.length>0){f=e(a,b.filter(function(a){return null!==a.target&&a.target.type===g.TargetTypeEnum.ConstructorArgument}).map(function(a){return c(a)})),f=d(f,b,c)}else f=new a;return f}Object.defineProperty(b,"__esModule",{value:!0});var g=c(17);b.resolveInstance=f},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c(34),e=c(36),f=c(17),g=c(19),h=function(){function a(a){this._binding=a}return a.prototype.to=function(a){return this._binding.type=f.BindingTypeEnum.Instance,this._binding.implementationType=a,new d.BindingInWhenOnSyntax(this._binding)},a.prototype.toSelf=function(){if("function"!=typeof this._binding.serviceIdentifier)throw new Error(""+g.INVALID_TO_SELF_VALUE);var a=this._binding.serviceIdentifier;return this.to(a)},a.prototype.toConstantValue=function(a){return this._binding.type=f.BindingTypeEnum.ConstantValue,this._binding.cache=a,this._binding.dynamicValue=null,this._binding.implementationType=null,new e.BindingWhenOnSyntax(this._binding)},a.prototype.toDynamicValue=function(a){return this._binding.type=f.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=a,this._binding.implementationType=null,new d.BindingInWhenOnSyntax(this._binding)},a.prototype.toConstructor=function(a){return this._binding.type=f.BindingTypeEnum.Constructor,this._binding.implementationType=a,new e.BindingWhenOnSyntax(this._binding)},a.prototype.toFactory=function(a){return this._binding.type=f.BindingTypeEnum.Factory,this._binding.factory=a,new e.BindingWhenOnSyntax(this._binding)},a.prototype.toFunction=function(a){if("function"!=typeof a)throw new Error(g.INVALID_FUNCTION_BINDING);var b=this.toConstantValue(a);return this._binding.type=f.BindingTypeEnum.Function,b},a.prototype.toAutoFactory=function(a){return this._binding.type=f.BindingTypeEnum.Factory,this._binding.factory=function(b){return function(){return b.container.get(a)}},new e.BindingWhenOnSyntax(this._binding)},a.prototype.toProvider=function(a){return this._binding.type=f.BindingTypeEnum.Provider,this._binding.provider=a,new e.BindingWhenOnSyntax(this._binding)},a}();b.BindingToSyntax=h},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c(35),e=c(37),f=c(38),g=function(){function a(a){this._binding=a,this._bindingWhenSyntax=new e.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new f.BindingOnSyntax(this._binding),this._bindingInSyntax=new d.BindingInSyntax(a)}return a.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},a.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},a.prototype.when=function(a){return this._bindingWhenSyntax.when(a)},a.prototype.whenTargetNamed=function(a){return this._bindingWhenSyntax.whenTargetNamed(a)},a.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},a.prototype.whenTargetTagged=function(a,b){return this._bindingWhenSyntax.whenTargetTagged(a,b)},a.prototype.whenInjectedInto=function(a){return this._bindingWhenSyntax.whenInjectedInto(a)},a.prototype.whenParentNamed=function(a){return this._bindingWhenSyntax.whenParentNamed(a)},a.prototype.whenParentTagged=function(a,b){return this._bindingWhenSyntax.whenParentTagged(a,b)},a.prototype.whenAnyAncestorIs=function(a){return this._bindingWhenSyntax.whenAnyAncestorIs(a)},a.prototype.whenNoAncestorIs=function(a){return this._bindingWhenSyntax.whenNoAncestorIs(a)},a.prototype.whenAnyAncestorNamed=function(a){return this._bindingWhenSyntax.whenAnyAncestorNamed(a)},a.prototype.whenAnyAncestorTagged=function(a,b){return this._bindingWhenSyntax.whenAnyAncestorTagged(a,b)},a.prototype.whenNoAncestorNamed=function(a){return this._bindingWhenSyntax.whenNoAncestorNamed(a)},a.prototype.whenNoAncestorTagged=function(a,b){return this._bindingWhenSyntax.whenNoAncestorTagged(a,b)},a.prototype.whenAnyAncestorMatches=function(a){return this._bindingWhenSyntax.whenAnyAncestorMatches(a)},a.prototype.whenNoAncestorMatches=function(a){return this._bindingWhenSyntax.whenNoAncestorMatches(a)},a.prototype.onActivation=function(a){return this._bindingOnSyntax.onActivation(a)},a}();b.BindingInWhenOnSyntax=g},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c(17),e=c(36),f=function(){function a(a){this._binding=a}return a.prototype.inSingletonScope=function(){return this._binding.scope=d.BindingScopeEnum.Singleton,new e.BindingWhenOnSyntax(this._binding)},a.prototype.inTransientScope=function(){return this._binding.scope=d.BindingScopeEnum.Transient,new e.BindingWhenOnSyntax(this._binding)},a}();b.BindingInSyntax=f},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c(37),e=c(38),f=function(){function a(a){this._binding=a,this._bindingWhenSyntax=new d.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new e.BindingOnSyntax(this._binding)}return a.prototype.when=function(a){return this._bindingWhenSyntax.when(a)},a.prototype.whenTargetNamed=function(a){return this._bindingWhenSyntax.whenTargetNamed(a)},a.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},a.prototype.whenTargetTagged=function(a,b){return this._bindingWhenSyntax.whenTargetTagged(a,b)},a.prototype.whenInjectedInto=function(a){return this._bindingWhenSyntax.whenInjectedInto(a)},a.prototype.whenParentNamed=function(a){return this._bindingWhenSyntax.whenParentNamed(a)},a.prototype.whenParentTagged=function(a,b){return this._bindingWhenSyntax.whenParentTagged(a,b)},a.prototype.whenAnyAncestorIs=function(a){return this._bindingWhenSyntax.whenAnyAncestorIs(a)},a.prototype.whenNoAncestorIs=function(a){return this._bindingWhenSyntax.whenNoAncestorIs(a)},a.prototype.whenAnyAncestorNamed=function(a){return this._bindingWhenSyntax.whenAnyAncestorNamed(a)},a.prototype.whenAnyAncestorTagged=function(a,b){return this._bindingWhenSyntax.whenAnyAncestorTagged(a,b)},a.prototype.whenNoAncestorNamed=function(a){return this._bindingWhenSyntax.whenNoAncestorNamed(a)},a.prototype.whenNoAncestorTagged=function(a,b){return this._bindingWhenSyntax.whenNoAncestorTagged(a,b)},a.prototype.whenAnyAncestorMatches=function(a){return this._bindingWhenSyntax.whenAnyAncestorMatches(a)},a.prototype.whenNoAncestorMatches=function(a){return this._bindingWhenSyntax.whenNoAncestorMatches(a)},a.prototype.onActivation=function(a){return this._bindingOnSyntax.onActivation(a)},a}();b.BindingWhenOnSyntax=f},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c(38),e=c(39),f=function(){function a(a){this._binding=a}return a.prototype.when=function(a){return this._binding.constraint=a,new d.BindingOnSyntax(this._binding)},a.prototype.whenTargetNamed=function(a){return this._binding.constraint=e.namedConstraint(a),new d.BindingOnSyntax(this._binding)},a.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(a){return null!==a.target&&!1===a.target.isNamed()&&!1===a.target.isTagged()},new d.BindingOnSyntax(this._binding)},a.prototype.whenTargetTagged=function(a,b){return this._binding.constraint=e.taggedConstraint(a)(b),new d.BindingOnSyntax(this._binding)},a.prototype.whenInjectedInto=function(a){return this._binding.constraint=function(b){return e.typeConstraint(a)(b.parentRequest)},new d.BindingOnSyntax(this._binding)},a.prototype.whenParentNamed=function(a){return this._binding.constraint=function(b){return e.namedConstraint(a)(b.parentRequest)},new d.BindingOnSyntax(this._binding)},a.prototype.whenParentTagged=function(a,b){return this._binding.constraint=function(c){return e.taggedConstraint(a)(b)(c.parentRequest)},new d.BindingOnSyntax(this._binding)},a.prototype.whenAnyAncestorIs=function(a){return this._binding.constraint=function(b){return e.traverseAncerstors(b,e.typeConstraint(a))},new d.BindingOnSyntax(this._binding)},a.prototype.whenNoAncestorIs=function(a){return this._binding.constraint=function(b){return!e.traverseAncerstors(b,e.typeConstraint(a))},new d.BindingOnSyntax(this._binding)},a.prototype.whenAnyAncestorNamed=function(a){return this._binding.constraint=function(b){return e.traverseAncerstors(b,e.namedConstraint(a))},new d.BindingOnSyntax(this._binding)},a.prototype.whenNoAncestorNamed=function(a){return this._binding.constraint=function(b){return!e.traverseAncerstors(b,e.namedConstraint(a))},new d.BindingOnSyntax(this._binding)},a.prototype.whenAnyAncestorTagged=function(a,b){return this._binding.constraint=function(c){return e.traverseAncerstors(c,e.taggedConstraint(a)(b))},new d.BindingOnSyntax(this._binding)},a.prototype.whenNoAncestorTagged=function(a,b){return this._binding.constraint=function(c){return!e.traverseAncerstors(c,e.taggedConstraint(a)(b))},new d.BindingOnSyntax(this._binding)},a.prototype.whenAnyAncestorMatches=function(a){return this._binding.constraint=function(b){return e.traverseAncerstors(b,a)},new d.BindingOnSyntax(this._binding)},a.prototype.whenNoAncestorMatches=function(a){return this._binding.constraint=function(b){return!e.traverseAncerstors(b,a)},new d.BindingOnSyntax(this._binding)},a}();b.BindingWhenSyntax=f},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c(37),e=function(){function a(a){this._binding=a}return a.prototype.onActivation=function(a){return this._binding.onActivation=a,new d.BindingWhenSyntax(this._binding)},a}();b.BindingOnSyntax=e},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c(25),e=c(26),f=function(a,b){var c=a.parentRequest;return null!==c&&(!!b(c)||f(c,b))};b.traverseAncerstors=f;var g=function(a){return function(b){var c=function(c){return null!==c&&null!==c.target&&c.target.matchesTag(a)(b)};return c.metaData=new d.Metadata(a,b),c}};b.taggedConstraint=g;var h=g(e.NAMED_TAG);b.namedConstraint=h;var i=function(a){return function(b){var c=null;if(null!==b){if(c=b.bindings[0],"string"==typeof a){return c.serviceIdentifier===a}var d=b.bindings[0].implementationType;return a===d}return!1}};b.typeConstraint=i},function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var c=function(){function a(){}return a.of=function(b,c){var d=new a;return d.bindings=b,d.middleware=c,d},a}();b.ContainerSnapshot=c},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c(26),e=function(){function a(){}return a.prototype.getConstructorMetadata=function(a){return{compilerGeneratedMetadata:Reflect.getMetadata(d.PARAM_TYPES,a),userGeneratedMetadata:Reflect.getMetadata(d.TAGGED,a)||{}}},a.prototype.getPropertiesMetadata=function(a){return Reflect.getMetadata(d.TAGGED_PROP,a)||[]},a}();b.MetadataReader=e},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c(16),e=function(){function a(a){this.guid=d.guid(),this.registry=a}return a}();b.ContainerModule=e},function(a,b,c){"use strict";function d(){return function(a){if(!0===Reflect.hasOwnMetadata(e.PARAM_TYPES,a))throw new Error(f.DUPLICATED_INJECTABLE_DECORATOR);var b=Reflect.getMetadata(e.DESIGN_PARAM_TYPES,a)||[];return Reflect.defineMetadata(e.PARAM_TYPES,b,a),a}}Object.defineProperty(b,"__esModule",{value:!0});var e=c(26),f=c(19);b.injectable=d},function(a,b,c){"use strict";function d(a,b){return function(c,d,g){var h=new e.Metadata(a,b);"number"==typeof g?f.tagParameter(c,d,g,h):f.tagProperty(c,d,h)}}Object.defineProperty(b,"__esModule",{value:!0});var e=c(25),f=c(45);b.tagged=d},function(a,b,c){"use strict";function d(a,b,c,d){f(j.TAGGED,a,b,d,c)}function e(a,b,c){f(j.TAGGED_PROP,a.constructor,b,c)}function f(a,b,c,d,e){var f={},g="number"==typeof e,h=void 0!==e&&g?e.toString():c;if(!0===g&&void 0!==c)throw new Error(k.INVALID_DECORATOR_OPERATION);!0===Reflect.hasOwnMetadata(a,b)&&(f=Reflect.getMetadata(a,b));var i=f[h];if(!0!==Array.isArray(i))i=[];else for(var j=0;j<i.length;j++){var l=i[j];if(l.key===d.key)throw new Error(k.DUPLICATED_METADATA+" "+l.key)}i.push(d),f[h]=i,Reflect.defineMetadata(a,f,b)}function g(a,b){Reflect.decorate(a,b)}function h(a,b){return function(c,d){b(c,d,a)}}function i(a,b,c){"number"==typeof c?g([h(c,a)],b):g([a],b)}Object.defineProperty(b,"__esModule",{value:!0});var j=c(26),k=c(19);b.tagParameter=d,b.tagProperty=e,b.decorate=i},function(a,b,c){"use strict";function d(a){return function(b,c,d){var h=new e.Metadata(g.NAMED_TAG,a);"number"==typeof d?f.tagParameter(b,c,d,h):f.tagProperty(b,c,h)}}Object.defineProperty(b,"__esModule",{value:!0});var e=c(25),f=c(45),g=c(26);b.named=d},function(a,b,c){"use strict";function d(a){return function(b,c,d){var h=new e.Metadata(g.INJECT_TAG,a);"number"==typeof d?f.tagParameter(b,c,d,h):f.tagProperty(b,c,h)}}Object.defineProperty(b,"__esModule",{value:!0});var e=c(25),f=c(45),g=c(26);b.inject=d},function(a,b,c){"use strict";function d(){return function(a,b,c){var d=new e.Metadata(g.OPTIONAL_TAG,!0);"number"==typeof c?f.tagParameter(a,b,c,d):f.tagProperty(a,b,d)}}Object.defineProperty(b,"__esModule",{value:!0});var e=c(25),f=c(45),g=c(26);b.optional=d},function(a,b,c){"use strict";function d(){return function(a,b,c){var d=new e.Metadata(g.UNMANAGED_TAG,!0);f.tagParameter(a,b,c,d)}}Object.defineProperty(b,"__esModule",{value:!0});var e=c(25),f=c(45),g=c(26);b.unmanaged=d},function(a,b,c){"use strict";function d(a){return function(b,c,d){var h=new e.Metadata(g.MULTI_INJECT_TAG,a);"number"==typeof d?f.tagParameter(b,c,d,h):f.tagProperty(b,c,h)}}Object.defineProperty(b,"__esModule",{value:!0});var e=c(25),f=c(45),g=c(26);b.multiInject=d},function(a,b,c){"use strict";function d(a){return function(b,c,d){var h=new e.Metadata(g.NAME_TAG,a);f.tagParameter(b,c,d,h)}}Object.defineProperty(b,"__esModule",{value:!0});var e=c(25),f=c(45),g=c(26);b.targetName=d},function(a,b,c){"use strict";var d=this&&this.__decorate||function(a,b,c,d){var e,f=arguments.length,g=f<3?b:null===d?d=Object.getOwnPropertyDescriptor(b,c):d;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)g=Reflect.decorate(a,b,c,d);else for(var h=a.length-1;h>=0;h--)(e=a[h])&&(g=(f<3?e(g):f>3?e(b,c,g):e(b,c))||g);return f>3&&g&&Object.defineProperty(b,c,g),g},e=this&&this.__metadata||function(a,b){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(a,b)};Object.defineProperty(b,"__esModule",{value:!0});var f=c(13),g=function(){function a(){this.eventSubscribers=[]}return a.prototype.subscribeToLocalEvent=function(a,b){this.eventSubscribers.push({eventType:a,handler:b})},a.prototype.isSubscribedToLocalEvent=function(a){for(var b=!1,c=0,d=this.eventSubscribers;c<d.length;c++){if(d[c].eventType===a){b=!0;break}}return b},a.prototype.unsubscribeFromLocalEvent=function(a,b){for(var c=this.eventSubscribers.length-1;c>=0;c--){var d=this.eventSubscribers[c];b&&d.handler===b&&d.eventType===a?this.eventSubscribers.splice(c,1):d.eventType===a&&this.eventSubscribers.splice(c,1)}},a.prototype.publishLocalEvent=function(a,b){var c=this;setTimeout(function(){for(var d=0,e=c.eventSubscribers;d<e.length;d++){var f=e[d];f.eventType===a&&f.handler(b)}})},a}();g=d([f.injectable(),e("design:paramtypes",[])],g),b.EventManager=g},function(a,b,c){"use strict";var d=this&&this.__decorate||function(a,b,c,d){var e,f=arguments.length,g=f<3?b:null===d?d=Object.getOwnPropertyDescriptor(b,c):d;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)g=Reflect.decorate(a,b,c,d);else for(var h=a.length-1;h>=0;h--)(e=a[h])&&(g=(f<3?e(g):f>3?e(b,c,g):e(b,c))||g);return f>3&&g&&Object.defineProperty(b,c,g),g},e=this&&this.__metadata||function(a,b){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(a,b)},f=this&&this.__param||function(a,b){return function(c,d){b(c,d,a)}};Object.defineProperty(b,"__esModule",{value:!0});var g=c(13),h=c(11),i=function(){function a(a){this._comapiConfig=a,a&&a.localStoragePrefix?this._prefix=a.localStoragePrefix:this._prefix="comapi."}return Object.defineProperty(a.prototype,"prefix",{set:function(a){this._prefix=a},enumerable:!0,configurable:!0}),a.prototype.getString=function(a){return localStorage.getItem(this._prefix+a)},a.prototype.setString=function(a,b){localStorage.setItem(this._prefix+a,b)},a.prototype.getObject=function(a){var b=null,c=this.getString(a);try{b=JSON.parse(c)}catch(b){console.error("caught exception in LocalStorageData.get("+a+"): "+b)}return b},a.prototype.setObject=function(a,b){var c=!0;try{
var d=JSON.stringify(b);this.setString(a,d)}catch(b){console.log("caught exception in LocalStorageData.set("+a+"): "+b),c=!1}return c},a.prototype.remove=function(a){try{localStorage.removeItem(this._prefix+a)}catch(b){console.error("caught exception in LocalStorageData.remove("+a+"): "+b)}},a}();i=d([g.injectable(),f(0,g.inject(h.INTERFACE_SYMBOLS.ComapiConfig)),e("design:paramtypes",[Object])],i),b.LocalStorageData=i},function(a,b,c){"use strict";var d=this&&this.__decorate||function(a,b,c,d){var e,f=arguments.length,g=f<3?b:null===d?d=Object.getOwnPropertyDescriptor(b,c):d;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)g=Reflect.decorate(a,b,c,d);else for(var h=a.length-1;h>=0;h--)(e=a[h])&&(g=(f<3?e(g):f>3?e(b,c,g):e(b,c))||g);return f>3&&g&&Object.defineProperty(b,c,g),g},e=this&&this.__metadata||function(a,b){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(a,b)},f=this&&this.__param||function(a,b){return function(c,d){b(c,d,a)}};Object.defineProperty(b,"__esModule",{value:!0});var g=c(13),h=c(4),i=c(55),j=c(11),k=function(){function a(a,b,c){this._eventManager=a,this._localStorageData=b,this._indexedDB=c,this._logLevel=h.LogLevels.Debug,this._uid=("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4),this._maxLocalStorageLogSize=1024,this._localStorageKey="rollingLogfile"}return Object.defineProperty(a.prototype,"logLevel",{get:function(){return this._logLevel},set:function(a){this._logLevel=a},enumerable:!0,configurable:!0}),a.prototype.log=function(a,b){return this._log(h.LogLevels.Debug,a,b)},a.prototype.warn=function(a,b){return this._log(h.LogLevels.Warn,a,b)},a.prototype.error=function(a,b){return this._log(h.LogLevels.Error,a,b)},a.prototype.getLog=function(){var a=this;return new Promise(function(b,c){a._indexedDB?a._indexedDB.getData().then(function(a){b(JSON.stringify(a))}).catch(function(a){c(a)}):a._localStorageData?b(a._localStorageData.getString(a._localStorageKey)):c({message:"No logfile to get"})})},a.prototype.clearLog=function(){var a=this;return new Promise(function(b,c){a._indexedDB?a._indexedDB.clearData().then(function(){b(!0)}).catch(function(a){c(a)}):a._localStorageData?(a._localStorageData.remove(a._localStorageKey),b(!0)):c({message:"No logfile to clear"})})},a.prototype._stringForLogLevel=function(a){switch(a){case h.LogLevels.Debug:return"Debug";case h.LogLevels.Warn:return"Warning";case h.LogLevels.Error:return"Error";default:return"?"}},a.prototype._log=function(a,b,c){var d=this;return new Promise(function(e,f){if(a<=d._logLevel){var g="["+d._uid+"] : "+(new Date).toJSON()+" ["+d._stringForLogLevel(a)+"] : "+b+(void 0!==c?" : "+JSON.stringify(c):"")+"\r\n";switch(a){case h.LogLevels.Error:console.error(g);break;case h.LogLevels.Warn:console.warn(g);break;case h.LogLevels.Debug:console.log(g)}var i=new Date,j={created:i.valueOf(),data:c,logLevel:a,message:b,timestamp:i.toISOString()};if(d._indexedDB)d._indexedDB.addRecord(j).then(function(a){e(!0)});else if(d._localStorageData){var k=d._localStorageData.getString(d._localStorageKey);null!==k?k+=g:k=g,k.length>d._maxLocalStorageLogSize&&(k=k.substring(g.length)),d._localStorageData.setString(d._localStorageKey,k),e(!0)}else e(!0);d._eventManager&&d._eventManager.publishLocalEvent("LogMessage",j)}})},a}();k=d([g.injectable(),f(0,g.inject(j.INTERFACE_SYMBOLS.EventManager)),f(1,g.inject(j.INTERFACE_SYMBOLS.LocalStorageData)),f(2,g.inject(j.INTERFACE_SYMBOLS.IndexedDBLogger)),f(2,g.optional()),e("design:paramtypes",[Object,Object,i.IndexedDBLogger])],k),b.Logger=k},function(a,b,c){"use strict";var d=this&&this.__decorate||function(a,b,c,d){var e,f=arguments.length,g=f<3?b:null===d?d=Object.getOwnPropertyDescriptor(b,c):d;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)g=Reflect.decorate(a,b,c,d);else for(var h=a.length-1;h>=0;h--)(e=a[h])&&(g=(f<3?e(g):f>3?e(b,c,g):e(b,c))||g);return f>3&&g&&Object.defineProperty(b,c,g),g},e=this&&this.__metadata||function(a,b){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(a,b)},f=this&&this.__param||function(a,b){return function(c,d){b(c,d,a)}};Object.defineProperty(b,"__esModule",{value:!0});var g=c(13),h=c(11),i=c(56),j=function(){function a(a){this._comapiConfig=a,this.idbSupported="indexedDB"in window,this._version=1,this._store="Logs",this._mutex=new i.Mutex,this._name="Comapi"}return Object.defineProperty(a.prototype,"name",{set:function(a){this._name=a},enumerable:!0,configurable:!0}),a.prototype.purge=function(a){var b=this;return this._mutex.runExclusive(function(){return b.ensureInitialised().then(function(c){return new Promise(function(c,d){var e=b._database.transaction([b._store],"readwrite"),f=e.objectStore(b._store),g=f.index("created"),h=IDBKeyRange.upperBound(a.valueOf());g.openCursor(h).onsuccess=function(a){var b=a.target.result;b?(f.delete(b.primaryKey),b.continue()):c(!0)}})})})},a.prototype.deleteDatabase=function(){var a=this;return this._mutex.runExclusive(function(){return a.ensureInitialised().then(function(b){return new Promise(function(b,c){var d=indexedDB.deleteDatabase(a._name),e=a;d.onsuccess=function(){console.log("Deleted database "+e._name+" successfully"),b(!0)},d.onerror=function(a){c({message:"Couldn't delete database "+e._name+" : "+a.target.error.name})},d.onblocked=function(){console.warn("Couldn't delete database "+e._name+" due to the operation being blocked")}})})})},a.prototype.clearData=function(){var a=this;return this._mutex.runExclusive(function(){return a.ensureInitialised().then(function(b){return new Promise(function(b,c){var d=a._database.transaction([a._store],"readwrite");d.onerror=function(a){console.error("Transaction not opened due to error: "+d.error)};var e=d.objectStore(a._store),f=e.clear();f.onsuccess=function(a){b(!0)},f.onerror=function(a){c({message:"Failed to clear object store: "+a.target.error.name})}})})})},a.prototype.getData=function(a,b){var c=this;return this._mutex.runExclusive(function(){return c.ensureInitialised().then(function(d){return new Promise(function(d,e){var f=c._database.transaction([c._store],"readonly"),g=f.objectStore(c._store),h=g.openCursor(),i=0,j=[];h.onsuccess=function(c){var e=c.target.result;if(i++,e){var f=e.value;!0===b&&(f.key=e.key),j.push(e.value),i&&i>=a?d(j):e.continue()}else d(j)},h.onerror=function(a){e({message:"Failed to openCursor: "+a.target.error.name})}})})})},a.prototype.getCount=function(){var a=this;return this._mutex.runExclusive(function(){return a.ensureInitialised().then(function(b){return new Promise(function(b,c){var d=a._database.transaction([a._store],"readonly"),e=d.objectStore(a._store),f=e.count();f.onerror=function(a){c({message:"Failed to get count: "+a.target.error.name})},f.onsuccess=function(){b(f.result)}})})})},a.prototype.closeDatabase=function(){this._database&&this._database.close()},a.prototype.addRecord=function(a){var b=this;return this._mutex.runExclusive(function(){return b.ensureInitialised().then(function(c){return new Promise(function(c,d){var e=b._database.transaction([b._store],"readwrite"),f=e.objectStore(b._store),g=f.add(a);g.onerror=function(a){console.error("Error",a.target.error.name),d({message:"add failed: "+a.target.error.name})},g.onsuccess=function(a){c(a.target.result)}})})})},a.prototype.ensureInitialised=function(){var a=this;return this._initialised||(this._initialised=this.initialise().then(function(b){if(a._comapiConfig){var c=void 0===a._comapiConfig.logRetentionHours?24:a._comapiConfig.logRetentionHours,d=new Date((new Date).valueOf()-36e5*c);return a.purge(d)}return b})),this._initialised},a.prototype.initialise=function(){var a=this;return new Promise(function(b,c){if(a.idbSupported){var d=a,e=indexedDB.open(a._name,a._version);e.onupgradeneeded=function(a){console.log("Upgrading database...");var b=a.target.result;if(!b.objectStoreNames.contains(d._store)){b.createObjectStore(d._store,{autoIncrement:!0}).createIndex("created","created",{unique:!1})}},e.onsuccess=function(a){d._database=a.target.result,b(!0)},e.onerror=function(a){c({message:"IndexedDBLogger.open failed : "+a.target.error.name})}}else c({message:"IndexedDBLogger not supported on this platform"})})},a}();j=d([g.injectable(),f(0,g.inject(h.INTERFACE_SYMBOLS.ComapiConfig)),f(0,g.optional()),e("design:paramtypes",[Object])],j),b.IndexedDBLogger=j},function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var c=function(){function a(){this._queue=[],this._pending=!1}return a.prototype.acquire=function(){var a=this,b=new Promise(function(b){return a._queue.push(b)});return this._pending||this._dispatchNext(),b},a.prototype.runExclusive=function(a){return this.acquire().then(function(b){var c;try{c=a()}catch(a){throw b(),a}return Promise.resolve(c).then(function(a){return b(),a},function(a){throw b(),a})})},a.prototype._dispatchNext=function(){this._queue.length>0?(this._pending=!0,this._queue.shift()(this._dispatchNext.bind(this))):this._pending=!1},a}();b.Mutex=c},function(a,b,c){"use strict";var d=this&&this.__decorate||function(a,b,c,d){var e,f=arguments.length,g=f<3?b:null===d?d=Object.getOwnPropertyDescriptor(b,c):d;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)g=Reflect.decorate(a,b,c,d);else for(var h=a.length-1;h>=0;h--)(e=a[h])&&(g=(f<3?e(g):f>3?e(b,c,g):e(b,c))||g);return f>3&&g&&Object.defineProperty(b,c,g),g},e=this&&this.__metadata||function(a,b){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(a,b)},f=this&&this.__param||function(a,b){return function(c,d){b(c,d,a)}};Object.defineProperty(b,"__esModule",{value:!0});var g=c(13),h=c(11),i=function(){function a(a){this.logger=a,this._readyStates=["request not initialized","server connection established","request received ","processing request","request finished and response is ready"]}return a.prototype.get=function(a,b){return this.makeRequest("GET",a,b)},a.prototype.post=function(a,b,c){return this.makeRequest("POST",a,b,c)},a.prototype.put=function(a,b,c){return this.makeRequest("PUT",a,b,c)},a.prototype.patch=function(a,b,c){return this.makeRequest("PATCH",a,b,c)},a.prototype.delete=function(a,b){return this.makeRequest("DELETE",a,b)},a.prototype.addHeaders=function(a,b){for(var c in b)b.hasOwnProperty(c)&&a.setRequestHeader(c,b[c])},a.prototype.getResponseHeaders=function(a){var b={},c=a.getAllResponseHeaders();if(c)for(var d=c.split("\r\n"),e=0;e<d.length;e++){var f=d[e],g=f.indexOf(": ");if(g>0){var h=f.substring(0,g),i=f.substring(g+2);b[h]=i}}return b},a.prototype.createCORSRequest=function(a,b){var c=new XMLHttpRequest;return"withCredentials"in c&&c.open(a,b,!0),c},a.prototype.makeRequest=function(a,b,c,d){var e=this;return new Promise(function(f,g){c=c||{},c["Content-Type"]||(c["Content-Type"]="application/json"),c["Cache-Control"]||(c["Cache-Control"]="no-cache"),e.logger&&e.logger.log(a+"'ing "+b+"  ...");var h=e.createCORSRequest(a,b);e.logger&&e.logger.log("Created XMLHttpRequest ..."),void 0!==c&&e.addHeaders(h,c),e.logger&&e.logger.log("added headers",c),h.onload=function(){e.logger&&e.logger.log("xhr.onload",h.responseText);var c=h.status>=200&&h.status<300,d={headers:e.getResponseHeaders(h),response:void 0,statusCode:h.status};if(h.responseText)try{d.response=JSON.parse(h.responseText),e.logger&&e.logger.log(a+"'ing to "+b+" returned this object: ",d.response)}catch(c){d.response=h.responseText,e.logger&&e.logger.log(a+"'ing to "+b+" returned this text: "+h.responseText)}c?f(d):g(d)},h.onerror=function(){e.logger&&e.logger.log("xhr.onerror",h.responseText),e.logger&&e.logger.error(a+"'ing to "+b+" failed");var c={headers:e.getResponseHeaders(h),response:h.responseText,statusCode:h.status};g(c)},h.onreadystatechange=function(a){e.logger&&e.logger.log("onreadystatechange: "+e._readyStates[h.readyState]+" [status="+h.status+"]")},h.onabort=function(a){e.logger&&e.logger.log("onabort",a)},h.send(d?JSON.stringify(d):null),e.logger&&e.logger.log("send data",d)})},a}();i=d([g.injectable(),f(0,g.inject(h.INTERFACE_SYMBOLS.Logger)),f(0,g.optional()),e("design:paramtypes",[Object])],i),b.RestClient=i},function(a,b,c){"use strict";var d=this&&this.__decorate||function(a,b,c,d){var e,f=arguments.length,g=f<3?b:null===d?d=Object.getOwnPropertyDescriptor(b,c):d;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)g=Reflect.decorate(a,b,c,d);else for(var h=a.length-1;h>=0;h--)(e=a[h])&&(g=(f<3?e(g):f>3?e(b,c,g):e(b,c))||g);return f>3&&g&&Object.defineProperty(b,c,g),g},e=this&&this.__metadata||function(a,b){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(a,b)},f=this&&this.__param||function(a,b){return function(c,d){b(c,d,a)}};Object.defineProperty(b,"__esModule",{value:!0});var g=c(13),h=c(11),i=function(){function a(a,b,c){this.logger=a,this.restClient=b,this.networkManager=c,this.retryCount=3}return a.prototype.get=function(a,b){var c=this;return b=b||{},this.networkManager.getValidToken().then(function(d){return b.authorization=c.constructAUthHeader(d),c.makeRequestWithRetry(0,c.restClient.get.bind(c.restClient),a,b)})},a.prototype.post=function(a,b,c){var d=this;return this.networkManager.getValidToken().then(function(e){return b.authorization=d.constructAUthHeader(e),d.makeRequestWithRetry(0,d.restClient.post.bind(d.restClient),a,b,c)})},a.prototype.patch=function(a,b,c){var d=this;return this.networkManager.getValidToken().then(function(e){return b.authorization=d.constructAUthHeader(e),d.makeRequestWithRetry(0,d.restClient.patch.bind(d.restClient),a,b,c)})},a.prototype.put=function(a,b,c){var d=this;return this.networkManager.getValidToken().then(function(e){return b.authorization=d.constructAUthHeader(e),d.makeRequestWithRetry(0,d.restClient.put.bind(d.restClient),a,b,c)})},a.prototype.delete=function(a,b){var c=this;return this.networkManager.getValidToken().then(function(d){return b.authorization=c.constructAUthHeader(d),c.makeRequestWithRetry(0,c.restClient.delete.bind(c.restClient),a,b)})},a.prototype.makeRequestWithRetry=function(a,b,c,d,e){var f=this;return b(c,d,e).catch(function(g){if(a<f.retryCount&&401===g.statusCode&&f.networkManager)return f.networkManager.restartSession().then(function(g){return d.authorization=f.constructAUthHeader(g.token),f.makeRequestWithRetry(++a,b,c,d,e)});throw g})},a.prototype.constructAUthHeader=function(a){return"Bearer "+a},a}();i=d([g.injectable(),f(0,g.inject(h.INTERFACE_SYMBOLS.Logger)),f(1,g.inject(h.INTERFACE_SYMBOLS.RestClient)),f(2,g.inject(h.INTERFACE_SYMBOLS.NetworkManager)),e("design:paramtypes",[Object,Object,Object])],i),b.AuthenticatedRestClient=i},function(a,b,c){"use strict";var d=this&&this.__decorate||function(a,b,c,d){var e,f=arguments.length,g=f<3?b:null===d?d=Object.getOwnPropertyDescriptor(b,c):d;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)g=Reflect.decorate(a,b,c,d);else for(var h=a.length-1;h>=0;h--)(e=a[h])&&(g=(f<3?e(g):f>3?e(b,c,g):e(b,c))||g);return f>3&&g&&Object.defineProperty(b,c,g),g},e=this&&this.__metadata||function(a,b){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(a,b)},f=this&&this.__param||function(a,b){return function(c,d){b(c,d,a)}};Object.defineProperty(b,"__esModule",{value:!0});var g=c(13),h=c(6),i=c(11),j=function(){function a(a,b,c,d){this._logger=a,this._restClient=b,this._localStorageData=c,this._comapiConfig=d,this._deviceId=c.getString("deviceId"),this._deviceId||(this._deviceId=h.Utils.uuid(),c.setString("deviceId",this._deviceId)),this._getSession()}return Object.defineProperty(a.prototype,"sessionInfo",{get:function(){return this._sessionInfo},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"expiry",{get:function(){return this._sessionInfo.session.expiresOn},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"isActive",{get:function(){var a=!1;if(this._sessionInfo){new Date<new Date(this._sessionInfo.session.expiresOn)?a=!0:this._removeSession()}return a},enumerable:!0,configurable:!0}),a.prototype.getValidToken=function(){return this.isActive?Promise.resolve(this._sessionInfo.token):this.startSession().then(function(a){return Promise.resolve(a.token)})},a.prototype.startSession=function(){var a=this,b=this;return new Promise(function(c,d){a.isActive?(b._logger.log("startSession() found an existing session: "),c(a._getSession())):a._startAuth().then(function(a){var e={nonce:a.nonce};b._comapiConfig.authChallenge(e,function(e){e?b._createAuthenticatedSession(e,a.authenticationId,{}).then(function(a){b._setSession(a),c(a)}).catch(function(a){d(a)}):d({message:"Failed to get a JWT from authChallenge",statusCode:401})})}).catch(function(a){return d(a)})})},a.prototype.endSession=function(){var a=this;return new Promise(function(b,c){a._sessionInfo?a._endAuth().then(function(c){a._removeSession(),b(!0)}).catch(function(c){a._removeSession(),b(!1)}):c({message:"No active session is present, create one before ending one"})})},a.prototype._createAuthenticatedSession=function(a,b,c){var d=h.Utils.getBrowserInfo(),e={authenticationId:b,authenticationToken:a,deviceId:this._deviceId,platform:"javascript",platformVersion:d.version,sdkType:"native",sdkVersion:"1.0.3.204"},f=h.Utils.format(this._comapiConfig.foundationRestUrls.sessions,{apiSpaceId:this._comapiConfig.apiSpaceId,urlBase:this._comapiConfig.urlBase});return this._restClient.post(f,{},e).then(function(a){return Promise.resolve(a.response)})},a.prototype._startAuth=function(){var a=h.Utils.format(this._comapiConfig.foundationRestUrls.sessionStart,{apiSpaceId:this._comapiConfig.apiSpaceId,urlBase:this._comapiConfig.urlBase});return this._restClient.get(a).then(function(a){return Promise.resolve(a.response)})},a.prototype._endAuth=function(){var a={"Content-Type":"application/json",authorization:this.getAuthHeader()},b=h.Utils.format(this._comapiConfig.foundationRestUrls.session,{apiSpaceId:this._comapiConfig.apiSpaceId,sessionId:this.sessionInfo.session.id,urlBase:this._comapiConfig.urlBase});return this._restClient.delete(b,a).then(function(a){return Promise.resolve(!0)})},a.prototype._getSession=function(){var a=this._localStorageData.getObject("session");if(a){if(a.token){var b=a.token.split(".");if(3===b.length){JSON.parse(atob(b[1])).apiSpaceId===this._comapiConfig.apiSpaceId&&(this._sessionInfo=a)}}this._sessionInfo||this._localStorageData.remove("session")}return this._sessionInfo},a.prototype._setSession=function(a){new Date(a.session.expiresOn)<new Date&&this._logger.error("Was given an expired token ;-("),this._sessionInfo=a,this._localStorageData.setObject("session",a)},a.prototype._removeSession=function(){this._localStorageData.remove("session"),this._sessionInfo=void 0},a.prototype.getAuthHeader=function(){return"Bearer "+this.sessionInfo.token},a}();j=d([g.injectable(),f(0,g.inject(i.INTERFACE_SYMBOLS.Logger)),f(1,g.inject(i.INTERFACE_SYMBOLS.RestClient)),f(2,g.inject(i.INTERFACE_SYMBOLS.LocalStorageData)),f(3,g.inject(i.INTERFACE_SYMBOLS.ComapiConfig)),e("design:paramtypes",[Object,Object,Object,Object])],j),b.SessionManager=j},function(a,b,c){"use strict";var d=this&&this.__decorate||function(a,b,c,d){var e,f=arguments.length,g=f<3?b:null===d?d=Object.getOwnPropertyDescriptor(b,c):d;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)g=Reflect.decorate(a,b,c,d);else for(var h=a.length-1;h>=0;h--)(e=a[h])&&(g=(f<3?e(g):f>3?e(b,c,g):e(b,c))||g);return f>3&&g&&Object.defineProperty(b,c,g),g},e=this&&this.__metadata||function(a,b){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(a,b)},f=this&&this.__param||function(a,b){return function(c,d){b(c,d,a)}};Object.defineProperty(b,"__esModule",{value:!0});var g=c(13),h=c(11),i=function(){function a(a,b,c,d,e,f){this._logger=a,this._localStorageData=b,this._comapiConfig=c,this._sessionManager=d,this._eventManager=e,this._eventMapper=f,this.readystates=["Connecting","Open","Closing","Closed"],this.manuallyClosed=!1,this.connected=!1,this.didConnect=!1,this.attempts=1,this.echoIntervalTimeout=18e4}return a.prototype.connect=function(){var a=this;return this._logger.log("WebSocketManager.connect();"),new Promise(function(b,c){a.webSocket?a.didConnect?b(!0):c({message:"Failed to connect webSocket"}):(a._logger.log("WebSocketManager.connect()"),a._sessionManager.getValidToken().then(function(d){a._logger.log("WebSocketManager.connect() - got auth token",d),a.manuallyClosed=!1;var e=a._comapiConfig.webSocketBase+"/apispaces/"+a._comapiConfig.apiSpaceId+"/socket",f="?token="+d,g=e+f;a._logger.log("connecting ...",g),a.webSocket=new WebSocket(g),a.echoIntervalId=setInterval(function(){return a.echo()},a.echoIntervalTimeout),a.webSocket.onopen=function(){a._logger.log("websocket onopen"),a.connected=!0,!1===a.didConnect&&(a.didConnect=!0,a._logger.log("resolving connect() promise"),b(!0)),a._eventManager.publishLocalEvent("WebsocketOpened",{timestamp:(new Date).toISOString()})},a.webSocket.onerror=function(b){a._logger.log("websocket onerror - readystate: "+a.readystates[a.webSocket.readyState],b)},a.webSocket.onmessage=function(b){var c;try{c=JSON.parse(b.data)}catch(c){a._logger.error("socket onmessage: (not JSON)",b.data)}c&&(a._logger.log("websocket onmessage: ",c),a.publishWebsocketEvent(c))},a.webSocket.onclose=function(b){if(a.connected=!1,a.webSocket=void 0,a._logger.log("WebSocket Connection closed."),a._eventManager.publishLocalEvent("WebsocketClosed",{timestamp:(new Date).toISOString()}),!1===a.didConnect&&c({code:b.code,message:"Failed to connect webSocket"}),!a.manuallyClosed&&a.didConnect){a._logger.log("socket not manually closed, reconnecting ...");var d=a.generateInterval(a.attempts);setTimeout(function(){a.attempts++,a._logger.log("reconnecting ..."),a.connect()},d)}}}))})},a.prototype.send=function(a){this.webSocket&&this.webSocket.send(JSON.stringify(a))},a.prototype.isConnected=function(){return this.didConnect},a.prototype.hasSocket=function(){return!!this.webSocket},a.prototype.disconnect=function(){var a=this;return this._logger.log("WebSocketManager.disconnect();"),new Promise(function(b,c){a.webSocket?(a.webSocket.onclose=function(){a.connected=!1,a.didConnect=!1,a._logger.log("socket closed."),a.webSocket=void 0,b(!0)},clearInterval(a.echoIntervalId),a.manuallyClosed=!0,a.webSocket.close()):b(!1)})},a.prototype.generateInterval=function(a){var b=1e3*(Math.pow(2,a)-1);b>3e4&&(b=3e4);var c=Math.random()*b;return this._logger.log("generateInterval() => "+c),c},a.prototype.echo=function(){this.connected&&this.send({name:"echo",payload:{},publishedOn:(new Date).toISOString()})},a.prototype.mapEventName=function(a){if(this._comapiConfig.eventMapping&&a){var b=a.split("."),c=b[0],d=b[1];for(var e in this._comapiConfig.eventMapping)if(this._comapiConfig.eventMapping.hasOwnProperty(e))for(var f=this._comapiConfig.eventMapping[e],g=0,h=f;g<h.length;g++){var i=h[g];if(i===c)return e+"."+d}}return a},a.prototype.publishWebsocketEvent=function(a){switch(this.mapEventName(a.name)){case"conversation.delete":this._eventManager.publishLocalEvent("conversationDeleted",this._eventMapper.conversationDeleted(a));break;case"conversation.undelete":this._eventManager.publishLocalEvent("conversationUndeleted",this._eventMapper.conversationUndeleted(a));break;case"conversation.update":this._eventManager.publishLocalEvent("conversationUpdated",this._eventMapper.conversationUpdated(a));break;case"conversation.participantAdded":this._eventManager.publishLocalEvent("participantAdded",this._eventMapper.participantAdded(a));break;case"conversation.participantRemoved":this._eventManager.publishLocalEvent("participantRemoved",this._eventMapper.participantRemoved(a));break;case"conversation.participantTyping":this._eventManager.publishLocalEvent("participantTyping",this._eventMapper.participantTyping(a));break;case"conversation.participantTypingOff":this._eventManager.publishLocalEvent("participantTypingOff",this._eventMapper.participantTypingOff(a));break;case"conversationMessage.sent":this._eventManager.publishLocalEvent("conversationMessageEvent",this._eventMapper.conversationMessageSent(a));break;case"conversationMessage.read":this._eventManager.publishLocalEvent("conversationMessageEvent",this._eventMapper.conversationMessageRead(a));break;case"conversationMessage.delivered":this._eventManager.publishLocalEvent("conversationMessageEvent",this._eventMapper.conversationMessageDelivered(a));break;case"profile.update":a.eTag&&this._localStorageData.setString("MyProfileETag",a.eTag),this._eventManager.publishLocalEvent("profileUpdated",this._eventMapper.profileUpdated(a));break;default:this._logger.warn("Unknown Event",a),this._eventManager.publishLocalEvent("webSocketEvent",a)}},a}();i=d([g.injectable(),f(0,g.inject(h.INTERFACE_SYMBOLS.Logger)),f(1,g.inject(h.INTERFACE_SYMBOLS.LocalStorageData)),f(2,g.inject(h.INTERFACE_SYMBOLS.ComapiConfig)),f(3,g.inject(h.INTERFACE_SYMBOLS.SessionManager)),f(4,g.inject(h.INTERFACE_SYMBOLS.EventManager)),f(5,g.inject(h.INTERFACE_SYMBOLS.EventMapper)),e("design:paramtypes",[Object,Object,Object,Object,Object,Object])],i),b.WebSocketManager=i},function(a,b,c){"use strict";var d=this&&this.__decorate||function(a,b,c,d){var e,f=arguments.length,g=f<3?b:null===d?d=Object.getOwnPropertyDescriptor(b,c):d;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)g=Reflect.decorate(a,b,c,d);else for(var h=a.length-1;h>=0;h--)(e=a[h])&&(g=(f<3?e(g):f>3?e(b,c,g):e(b,c))||g);return f>3&&g&&Object.defineProperty(b,c,g),g},e=this&&this.__metadata||function(a,b){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(a,b)},f=this&&this.__param||function(a,b){return function(c,d){b(c,d,a)}};Object.defineProperty(b,"__esModule",{value:!0});var g=c(13),h=c(11),i=c(56),j=function(){function a(a,b){this._sessionManager=a,this._webSocketManager=b,this._mutex=new i.Mutex}return a.prototype.startSession=function(){var a=this;return this._sessionManager.startSession().then(function(b){return a._webSocketManager.connect()}).then(function(b){return a._sessionManager.sessionInfo})},a.prototype.restartSession=function(){var a=this;return this._webSocketManager.disconnect().then(function(b){return a._sessionManager.startSession()}).then(function(b){return a._webSocketManager.connect()}).then(function(b){return a._sessionManager.sessionInfo})},Object.defineProperty(a.prototype,"session",{get:function(){return this._sessionManager.sessionInfo?this._sessionManager.sessionInfo.session:null},enumerable:!0,configurable:!0}),a.prototype.endSession=function(){var a=this;return this._webSocketManager.disconnect().then(function(){return a._sessionManager.endSession()})},a.prototype.getValidToken=function(){return this._sessionManager.getValidToken()},a.prototype.ensureSessionAndSocket=function(){var a=this;return this._mutex.runExclusive(function(){return a.ensureSession().then(function(b){return a.ensureSocket()}).then(function(b){return a._sessionManager.sessionInfo})})},a.prototype.ensureSession=function(){return this._sessionManager.sessionInfo?Promise.resolve(this._sessionManager.sessionInfo):this._sessionManager.startSession()},a.prototype.ensureSocket=function(){return this._webSocketManager.hasSocket()?Promise.resolve(!0):this._webSocketManager.connect()},a}();j=d([g.injectable(),f(0,g.inject(h.INTERFACE_SYMBOLS.SessionManager)),f(1,g.inject(h.INTERFACE_SYMBOLS.WebSocketManager)),e("design:paramtypes",[Object,Object])],j),b.NetworkManager=j},function(a,b,c){"use strict";var d=this&&this.__decorate||function(a,b,c,d){var e,f=arguments.length,g=f<3?b:null===d?d=Object.getOwnPropertyDescriptor(b,c):d;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)g=Reflect.decorate(a,b,c,d);else for(var h=a.length-1;h>=0;h--)(e=a[h])&&(g=(f<3?e(g):f>3?e(b,c,g):e(b,c))||g);return f>3&&g&&Object.defineProperty(b,c,g),g},e=this&&this.__metadata||function(a,b){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(a,b)},f=this&&this.__param||function(a,b){return function(c,d){b(c,d,a)}};Object.defineProperty(b,"__esModule",{value:!0});var g=c(13),h=c(4),i=c(6),j=c(11),k=function(){function a(a,b,c,d){this._logger=a,this._restClient=b,this._localStorageData=c,this._comapiConfig=d}return a.prototype.setFCMPushDetails=function(a,b,c){var d={fcm:{package:b,registrationId:c}};return this._restClient.put(this.getPushUrl(a),{},d).then(function(a){return Promise.resolve(!0)})},a.prototype.setAPNSPushDetails=function(a,b,c,d){var e={apns:{bundleId:b,environment:h.Environment[c],token:d}};return this._restClient.put(this.getPushUrl(a),{},e).then(function(a){return Promise.resolve(!0)})},a.prototype.removePushDetails=function(a){return this._restClient.delete(this.getPushUrl(a),{}).then(function(a){return Promise.resolve(!0)})},a.prototype.getPushUrl=function(a){return i.Utils.format(this._comapiConfig.foundationRestUrls.push,{apiSpaceId:this._comapiConfig.apiSpaceId,sessionId:a,urlBase:this._comapiConfig.urlBase})},a}();k=d([g.injectable(),f(0,g.inject(j.INTERFACE_SYMBOLS.Logger)),f(1,g.inject(j.INTERFACE_SYMBOLS.AuthenticatedRestClient)),f(2,g.inject(j.INTERFACE_SYMBOLS.LocalStorageData)),f(3,g.inject(j.INTERFACE_SYMBOLS.ComapiConfig)),e("design:paramtypes",[Object,Object,Object,Object])],k),b.DeviceManager=k},function(a,b,c){"use strict";var d=this&&this.__decorate||function(a,b,c,d){var e,f=arguments.length,g=f<3?b:null===d?d=Object.getOwnPropertyDescriptor(b,c):d;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)g=Reflect.decorate(a,b,c,d);else for(var h=a.length-1;h>=0;h--)(e=a[h])&&(g=(f<3?e(g):f>3?e(b,c,g):e(b,c))||g);return f>3&&g&&Object.defineProperty(b,c,g),g},e=this&&this.__metadata||function(a,b){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(a,b)},f=this&&this.__param||function(a,b){return function(c,d){b(c,d,a)}};Object.defineProperty(b,"__esModule",{value:!0});var g=c(13),h=c(6),i=c(11),j=function(){function a(a,b){this._restClient=a,this._comapiConfig=b}return a.prototype.createSendToMessengerState=function(a){var b=h.Utils.format(this._comapiConfig.foundationRestUrls.facebook,{apiSpaceId:this._comapiConfig.apiSpaceId,urlBase:this._comapiConfig.urlBase});return this._restClient.post(b,{},a||{})},a}();j=d([g.injectable(),f(0,g.inject(i.INTERFACE_SYMBOLS.AuthenticatedRestClient)),f(1,g.inject(i.INTERFACE_SYMBOLS.ComapiConfig)),e("design:paramtypes",[Object,Object])],j),b.FacebookManager=j},function(a,b,c){"use strict";var d=this&&this.__decorate||function(a,b,c,d){var e,f=arguments.length,g=f<3?b:null===d?d=Object.getOwnPropertyDescriptor(b,c):d;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)g=Reflect.decorate(a,b,c,d);else for(var h=a.length-1;h>=0;h--)(e=a[h])&&(g=(f<3?e(g):f>3?e(b,c,g):e(b,c))||g);return f>3&&g&&Object.defineProperty(b,c,g),g},e=this&&this.__metadata||function(a,b){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(a,b)},f=this&&this.__param||function(a,b){return function(c,d){b(c,d,a)}};Object.defineProperty(b,"__esModule",{value:!0});var g=c(13),h=c(4),i=c(6),j=c(11),k=function(){function a(a,b,c,d,e){this._logger=a,this._restClient=b,this._localStorageData=c,this._comapiConfig=d,this._sessionManager=e,this.isTypingInfo={},this.isTypingOffInfo={}}return a.prototype.createConversation=function(a){var b=i.Utils.format(this._comapiConfig.foundationRestUrls.conversations,{apiSpaceId:this._comapiConfig.apiSpaceId,urlBase:this._comapiConfig.urlBase});return this._restClient.post(b,{},a).then(function(a){return a.response._etag=i.Utils.getHeaderValue(a.headers,"ETag"),Promise.resolve(a.response)})},a.prototype.updateConversation=function(a,b){var c={};b&&(c["if-match"]=b);var d={description:a.description,isPublic:a.isPublic,name:a.name,roles:a.roles},e=i.Utils.format(this._comapiConfig.foundationRestUrls.conversation,{apiSpaceId:this._comapiConfig.apiSpaceId,conversationId:a.id,
urlBase:this._comapiConfig.urlBase});return this._restClient.put(e,c,d).then(function(a){return a.response._etag=i.Utils.getHeaderValue(a.headers,"ETag"),Promise.resolve(a.response)})},a.prototype.getConversation=function(a){var b=i.Utils.format(this._comapiConfig.foundationRestUrls.conversation,{apiSpaceId:this._comapiConfig.apiSpaceId,conversationId:a,urlBase:this._comapiConfig.urlBase});return this._restClient.get(b).then(function(a){return a.response._etag=i.Utils.getHeaderValue(a.headers,"ETag"),Promise.resolve(a.response)})},a.prototype.deleteConversation=function(a){var b=i.Utils.format(this._comapiConfig.foundationRestUrls.conversation,{apiSpaceId:this._comapiConfig.apiSpaceId,conversationId:a,urlBase:this._comapiConfig.urlBase});return this._restClient.delete(b,{}).then(function(a){return Promise.resolve(!0)})},a.prototype.addParticipantsToConversation=function(a,b){var c=i.Utils.format(this._comapiConfig.foundationRestUrls.participants,{apiSpaceId:this._comapiConfig.apiSpaceId,conversationId:a,urlBase:this._comapiConfig.urlBase});return this._restClient.post(c,{},b).then(function(a){return Promise.resolve(!0)})},a.prototype.deleteParticipantsFromConversation=function(a,b){for(var c="",d=0;d<b.length;d++)c+=0===d?"?id="+b[d]:"&id="+b[d];var e=i.Utils.format(this._comapiConfig.foundationRestUrls.participants,{apiSpaceId:this._comapiConfig.apiSpaceId,conversationId:a,urlBase:this._comapiConfig.urlBase});return this._restClient.delete(e+c,{}).then(function(a){return Promise.resolve(!0)})},a.prototype.getParticipantsInConversation=function(a){var b=i.Utils.format(this._comapiConfig.foundationRestUrls.participants,{apiSpaceId:this._comapiConfig.apiSpaceId,conversationId:a,urlBase:this._comapiConfig.urlBase});return this._restClient.get(b).then(function(a){return Promise.resolve(a.response)})},a.prototype.getConversations=function(a,b){var c=i.Utils.format(this._comapiConfig.foundationRestUrls.conversations,{apiSpaceId:this._comapiConfig.apiSpaceId,urlBase:this._comapiConfig.urlBase});return(a||b)&&(c+="?",void 0!==a&&(c+="scope="+h.ConversationScope[a]+"&"),void 0!==b&&(c+="profileId="+b)),this._restClient.get(c).then(function(a){return Promise.resolve(a.response)})},a.prototype.sendIsTyping=function(a){var b=this;if(this.isTypingInfo[a]){var c=new Date(this.isTypingInfo[a]);if(((new Date).getTime()-c.getTime())/1e3<(this._comapiConfig.isTypingTimeout||10))return Promise.resolve(!1)}var d=i.Utils.format(this._comapiConfig.foundationRestUrls.typing,{apiSpaceId:this._comapiConfig.apiSpaceId,conversationId:a,urlBase:this._comapiConfig.urlBase});return this._restClient.post(d,{},{}).then(function(c){return b.isTypingInfo[a]=(new Date).toISOString(),Promise.resolve(!0)})},a.prototype.sendIsTypingOff=function(a){var b=this;if(this.isTypingOffInfo[a]){var c=new Date(this.isTypingOffInfo[a]);if(((new Date).getTime()-c.getTime())/1e3<(this._comapiConfig.isTypingOffTimeout||10))return Promise.resolve(!1)}var d=i.Utils.format(this._comapiConfig.foundationRestUrls.typing,{apiSpaceId:this._comapiConfig.apiSpaceId,conversationId:a,urlBase:this._comapiConfig.urlBase});return this._restClient.delete(d,{}).then(function(c){return b.isTypingOffInfo[a]=(new Date).toISOString(),Promise.resolve(!0)})},a}();k=d([g.injectable(),f(0,g.inject(j.INTERFACE_SYMBOLS.Logger)),f(1,g.inject(j.INTERFACE_SYMBOLS.AuthenticatedRestClient)),f(2,g.inject(j.INTERFACE_SYMBOLS.LocalStorageData)),f(3,g.inject(j.INTERFACE_SYMBOLS.ComapiConfig)),f(4,g.inject(j.INTERFACE_SYMBOLS.SessionManager)),e("design:paramtypes",[Object,Object,Object,Object,Object])],k),b.ConversationManager=k},function(a,b,c){"use strict";var d=this&&this.__decorate||function(a,b,c,d){var e,f=arguments.length,g=f<3?b:null===d?d=Object.getOwnPropertyDescriptor(b,c):d;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)g=Reflect.decorate(a,b,c,d);else for(var h=a.length-1;h>=0;h--)(e=a[h])&&(g=(f<3?e(g):f>3?e(b,c,g):e(b,c))||g);return f>3&&g&&Object.defineProperty(b,c,g),g},e=this&&this.__metadata||function(a,b){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(a,b)},f=this&&this.__param||function(a,b){return function(c,d){b(c,d,a)}};Object.defineProperty(b,"__esModule",{value:!0});var g=c(13),h=c(6),i=c(11),j=function(){function a(a,b,c,d,e){this._logger=a,this._restClient=b,this._localStorageData=c,this._comapiConfig=d,this._sessionManager=e}return a.prototype.getProfile=function(a){var b=h.Utils.format(this._comapiConfig.foundationRestUrls.profile,{apiSpaceId:this._comapiConfig.apiSpaceId,profileId:a,urlBase:this._comapiConfig.urlBase});return this._restClient.get(b)},a.prototype.queryProfiles=function(a){var b=h.Utils.format(this._comapiConfig.foundationRestUrls.profiles,{apiSpaceId:this._comapiConfig.apiSpaceId,urlBase:this._comapiConfig.urlBase});return a&&(b+="?"+a),this._restClient.get(b)},a.prototype.updateProfile=function(a,b,c){var d={};c&&(d["If-Match"]=c);var e=h.Utils.clone(b);void 0===e.id&&(e.id=a);var f=h.Utils.format(this._comapiConfig.foundationRestUrls.profile,{apiSpaceId:this._comapiConfig.apiSpaceId,profileId:a,urlBase:this._comapiConfig.urlBase});return this._restClient.put(f,d,e)},a.prototype.patchProfile=function(a,b,c){var d={};c&&(d["If-Match"]=c);var e=h.Utils.clone(b);void 0===e.id&&(e.id=a);var f=h.Utils.format(this._comapiConfig.foundationRestUrls.profile,{apiSpaceId:this._comapiConfig.apiSpaceId,profileId:a,urlBase:this._comapiConfig.urlBase});return this._restClient.patch(f,d,e)},a}();j=d([g.injectable(),f(0,g.inject(i.INTERFACE_SYMBOLS.Logger)),f(1,g.inject(i.INTERFACE_SYMBOLS.AuthenticatedRestClient)),f(2,g.inject(i.INTERFACE_SYMBOLS.LocalStorageData)),f(3,g.inject(i.INTERFACE_SYMBOLS.ComapiConfig)),f(4,g.inject(i.INTERFACE_SYMBOLS.SessionManager)),e("design:paramtypes",[Object,Object,Object,Object,Object])],j),b.ProfileManager=j},function(a,b,c){"use strict";var d=this&&this.__decorate||function(a,b,c,d){var e,f=arguments.length,g=f<3?b:null===d?d=Object.getOwnPropertyDescriptor(b,c):d;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)g=Reflect.decorate(a,b,c,d);else for(var h=a.length-1;h>=0;h--)(e=a[h])&&(g=(f<3?e(g):f>3?e(b,c,g):e(b,c))||g);return f>3&&g&&Object.defineProperty(b,c,g),g},e=this&&this.__metadata||function(a,b){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(a,b)},f=this&&this.__param||function(a,b){return function(c,d){b(c,d,a)}};Object.defineProperty(b,"__esModule",{value:!0});var g=c(13),h=c(6),i=c(11),j=function(){function a(a,b,c,d,e){this._logger=a,this._restClient=b,this._localStorageData=c,this._comapiConfig=d,this._sessionManager=e}return a.prototype.getConversationEvents=function(a,b,c){var d=h.Utils.format(this._comapiConfig.foundationRestUrls.events,{apiSpaceId:this._comapiConfig.apiSpaceId,conversationId:a,urlBase:this._comapiConfig.urlBase});return d+="?from="+b,d+="&limit="+c,this._restClient.get(d).then(function(a){return Promise.resolve(a.response)})},a.prototype.getConversationMessages=function(a,b,c){var d=h.Utils.format(this._comapiConfig.foundationRestUrls.messages,{apiSpaceId:this._comapiConfig.apiSpaceId,conversationId:a,urlBase:this._comapiConfig.urlBase});return d+="?limit="+b,void 0!==c&&(d+="&from="+c),this._restClient.get(d).then(function(a){return Promise.resolve(a.response)})},a.prototype._sendMessageToConversation=function(a,b,c,d){var e={alert:d,metadata:b,parts:c},f=h.Utils.format(this._comapiConfig.foundationRestUrls.messages,{apiSpaceId:this._comapiConfig.apiSpaceId,conversationId:a,urlBase:this._comapiConfig.urlBase});return this._restClient.post(f,{},e).then(function(a){return Promise.resolve(a.response)})},a.prototype.sendMessageToConversation=function(a,b){var c=h.Utils.format(this._comapiConfig.foundationRestUrls.messages,{apiSpaceId:this._comapiConfig.apiSpaceId,conversationId:a,urlBase:this._comapiConfig.urlBase});return this._restClient.post(c,{},b).then(function(a){return Promise.resolve(a.response)})},a.prototype.sendMessageStatusUpdates=function(a,b){var c={"Content-Type":"application/json"},d=h.Utils.format(this._comapiConfig.foundationRestUrls.statusUpdates,{apiSpaceId:this._comapiConfig.apiSpaceId,conversationId:a,urlBase:this._comapiConfig.urlBase});return this._restClient.post(d,c,b).then(function(a){return Promise.resolve(a.response)})},a}();j=d([g.injectable(),f(0,g.inject(i.INTERFACE_SYMBOLS.Logger)),f(1,g.inject(i.INTERFACE_SYMBOLS.AuthenticatedRestClient)),f(2,g.inject(i.INTERFACE_SYMBOLS.LocalStorageData)),f(3,g.inject(i.INTERFACE_SYMBOLS.ComapiConfig)),f(4,g.inject(i.INTERFACE_SYMBOLS.SessionManager)),e("design:paramtypes",[Object,Object,Object,Object,Object])],j),b.MessageManager=j},function(a,b,c){"use strict";var d=this&&this.__decorate||function(a,b,c,d){var e,f=arguments.length,g=f<3?b:null===d?d=Object.getOwnPropertyDescriptor(b,c):d;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)g=Reflect.decorate(a,b,c,d);else for(var h=a.length-1;h>=0;h--)(e=a[h])&&(g=(f<3?e(g):f>3?e(b,c,g):e(b,c))||g);return f>3&&g&&Object.defineProperty(b,c,g),g};Object.defineProperty(b,"__esModule",{value:!0});var e=c(13),f=function(){function a(){this.idbSupported="indexedDB"in window,this._name="Comapi.OrphanedEvents",this._version=1,this._continuationTokenStore="ContinuationTokens",this._orphanedEventStore="OrphanedEvents"}return a.prototype.clearAll=function(){var a=this;return this.ensureInitialised().then(function(b){return a.clearObjectStore(a._continuationTokenStore)}).then(function(b){return a.clearObjectStore(a._orphanedEventStore)})},a.prototype.clear=function(a){var b=this;return this.ensureInitialised().then(function(c){return b.deleteTokenInfo(a)}).then(function(c){return b.deleteEvents(a)})},a.prototype.getContinuationToken=function(a){var b=this;return this.ensureInitialised().then(function(c){return new Promise(function(c,d){var e=b._database.transaction([b._continuationTokenStore],"readonly"),f=e.objectStore(b._continuationTokenStore),g=IDBKeyRange.only(a),h=f.openCursor(g);h.onsuccess=function(a){var b=a.target.result;if(b){var d=b.value;c(d.continuationToken)}else c(null)},h.onerror=function(a){d({message:"Failed to openCursor: "+a.target.error.name})}})})},a.prototype.setContinuationToken=function(a,b){var c=this;return this.ensureInitialised().then(function(d){return new Promise(function(d,e){var f=c._database.transaction([c._continuationTokenStore],"readwrite"),g=f.objectStore(c._continuationTokenStore),h=g.put({continuationToken:b,conversationId:a});h.onerror=function(a){e({message:"add failed: "+a.target.error.name})},h.onsuccess=function(a){d(!0)}})})},a.prototype.addOrphanedEvent=function(a){var b=this;return this.ensureInitialised().then(function(c){return new Promise(function(c,d){var e=b._database.transaction([b._orphanedEventStore],"readwrite"),f=e.objectStore(b._orphanedEventStore),g=f.put(a);g.onerror=function(a){console.error("Error",a.target.error.name),d({message:"add failed: "+a.target.error.name})},g.onsuccess=function(a){c(!0)}})})},a.prototype.removeOrphanedEvent=function(a){var b=this;return this.ensureInitialised().then(function(c){return new Promise(function(c,d){var e=b._database.transaction([b._orphanedEventStore],"readwrite"),f=e.objectStore(b._orphanedEventStore),g=f.delete(a.eventId);g.onerror=function(a){d({message:"delete failed: "+a.target.error.name})},g.onsuccess=function(a){console.log("store.delete",a.target.result),c(!0)}})})},a.prototype.getOrphanedEvents=function(a){var b=this;return this.ensureInitialised().then(function(c){return new Promise(function(c,d){var e=b._database.transaction([b._orphanedEventStore],"readonly"),f=e.objectStore(b._orphanedEventStore),g=f.index("conversationId"),h=IDBKeyRange.only(a),i=[],j=g.openCursor(h,"prev");j.onsuccess=function(a){var b=a.target.result;b?(i.unshift(b.value),b.continue()):c(i.sort(function(a,b){return a.conversationEventId-b.conversationEventId}))},j.onerror=function(a){d({message:"Failed to openCursor: "+a.target.error.name})}})})},a.prototype.ensureInitialised=function(){return this._initialised||(this._initialised=this.initialise()),this._initialised},a.prototype.initialise=function(){var a=this;return new Promise(function(b,c){if(a.idbSupported){var d=a,e=indexedDB.open(a._name,a._version);e.onupgradeneeded=function(a){var b=a.target.result;if(b.objectStoreNames.contains(d._continuationTokenStore)||b.createObjectStore(d._continuationTokenStore,{keyPath:"conversationId"}),!b.objectStoreNames.contains(d._orphanedEventStore)){b.createObjectStore(d._orphanedEventStore,{keyPath:"eventId"}).createIndex("conversationId","conversationId",{unique:!1})}},e.onsuccess=function(c){a._database=c.target.result,b(!0)},e.onerror=function(a){c({message:"IndexedDBOrphanedEventManager.initialise failed : "+a.target.error.name})}}else c({message:"IndexedDBOrphanedEventManager not supported on this platform"})})},a.prototype.clearObjectStore=function(a){var b=this,c=a;return new Promise(function(a,d){var e=b._database.transaction([c],"readwrite");e.onerror=function(a){console.error("Transaction not opened due to error: "+e.error)};var f=e.objectStore(c),g=f.clear();g.onsuccess=function(b){a(!0)},g.onerror=function(a){d({message:"Failed to clear object store: "+a.target.error.name})}})},a.prototype.deleteTokenInfo=function(a){var b=this;return new Promise(function(c,d){var e=b._database.transaction([b._continuationTokenStore],"readwrite"),f=e.objectStore(b._continuationTokenStore),g=f.delete(a);g.onerror=function(a){d({message:"delete failed: "+a.target.error.name})},g.onsuccess=function(a){console.log("store.delete",a.target.result),c(!0)}})},a.prototype.deleteEvents=function(a){var b=this;return new Promise(function(c,d){var e=b._database.transaction([b._orphanedEventStore],"readwrite"),f=e.objectStore(b._orphanedEventStore),g=f.index("conversationId"),h=IDBKeyRange.only(a),i=g.openCursor(h,"next");i.onsuccess=function(a){var b=a.target.result;b?(f.delete(b.primaryKey),b.continue()):c(!0)},i.onerror=function(a){d({message:"Failed to openCursor: "+a.target.error.name})}})},a}();f=d([e.injectable()],f),b.IndexedDBOrphanedEventManager=f},function(a,b,c){"use strict";var d=this&&this.__decorate||function(a,b,c,d){var e,f=arguments.length,g=f<3?b:null===d?d=Object.getOwnPropertyDescriptor(b,c):d;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)g=Reflect.decorate(a,b,c,d);else for(var h=a.length-1;h>=0;h--)(e=a[h])&&(g=(f<3?e(g):f>3?e(b,c,g):e(b,c))||g);return f>3&&g&&Object.defineProperty(b,c,g),g},e=this&&this.__metadata||function(a,b){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(a,b)},f=this&&this.__param||function(a,b){return function(c,d){b(c,d,a)}};Object.defineProperty(b,"__esModule",{value:!0});var g=c(13),h=c(11),i=function(){function a(a){this._localStorage=a,this._orphanedEevnts={},this._orphanedEevnts=this._localStorage.getObject("orphanedEevnts")||{}}return a.prototype.clearAll=function(){return this._orphanedEevnts={},this._localStorage.setObject("orphanedEevnts",this._orphanedEevnts),Promise.resolve(!0)},a.prototype.clear=function(a){return this._orphanedEevnts[a]={orphanedEvents:[]},this._localStorage.setObject("orphanedEevnts",this._orphanedEevnts),Promise.resolve(!0)},a.prototype.getContinuationToken=function(a){var b=this._orphanedEevnts[a];return Promise.resolve(b?b.continuationToken:null)},a.prototype.setContinuationToken=function(a,b){var c=this._orphanedEevnts[a];return c?c.continuationToken=b:this._orphanedEevnts[a]={continuationToken:b,orphanedEvents:[]},Promise.resolve(!0)},a.prototype.addOrphanedEvent=function(a){var b=this._orphanedEevnts[a.conversationId];if(!b)return Promise.reject({message:"No container for conversation "+a.conversationId});0===b.orphanedEvents.filter(function(b){return b.eventId===a.eventId}).length&&(b.orphanedEvents.unshift(a),b.orphanedEvents=b.orphanedEvents.sort(function(a,b){return a.conversationEventId>b.conversationEventId?1:a.conversationEventId<b.conversationEventId?-1:0}),this._localStorage.setObject("orphanedEevnts",this._orphanedEevnts))},a.prototype.removeOrphanedEvent=function(a){var b=this._orphanedEevnts[a.conversationId];if(b){for(var c=b.orphanedEvents.length-1;c>=0;c--){if(b.orphanedEvents[c].eventId===a.eventId){b.orphanedEvents.splice(c,1);break}}return this._localStorage.setObject("orphanedEevnts",this._orphanedEevnts),Promise.resolve(!0)}return Promise.reject({message:"No container for conversation "+a.conversationId})},a.prototype.getOrphanedEvents=function(a){var b=this._orphanedEevnts[a];return Promise.resolve(b?b.orphanedEvents:[])},a}();i=d([g.injectable(),f(0,g.inject(h.INTERFACE_SYMBOLS.LocalStorageData)),e("design:paramtypes",[Object])],i),b.LocalStorageOrphanedEventManager=i},function(a,b,c){"use strict";var d=this&&this.__decorate||function(a,b,c,d){var e,f=arguments.length,g=f<3?b:null===d?d=Object.getOwnPropertyDescriptor(b,c):d;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)g=Reflect.decorate(a,b,c,d);else for(var h=a.length-1;h>=0;h--)(e=a[h])&&(g=(f<3?e(g):f>3?e(b,c,g):e(b,c))||g);return f>3&&g&&Object.defineProperty(b,c,g),g},e=this&&this.__metadata||function(a,b){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(a,b)},f=this&&this.__param||function(a,b){return function(c,d){b(c,d,a)}};Object.defineProperty(b,"__esModule",{value:!0});var g=c(13),h=c(6),i=c(11),j=function(){function a(a,b,c,d){this._logger=a,this._localStorage=b,this._messageManager=c,this._orphanedEventManager=d}return a.prototype.getMessages=function(a,b,c){var d=this;if(c<=0)return Promise.reject({message:"All messages from conversation "+a+" have been loaded"});var e,f=null;return this._orphanedEventManager.getContinuationToken(a).then(function(b){return f=b,void 0!==c?f!==c?Promise.reject({message:"Invalid continuation token: "+c+" for "+a+", you nust start from the end"}):Promise.resolve(!0):d._orphanedEventManager.clear(a)}).then(function(){return d._messageManager.getConversationMessages(a,b,c)}).then(function(b){return e=b,void 0===b.messages?(d._logger.log("No messages in this channel yet"),Promise.resolve({messages:[]})):d.getOrphanedEvents(a,e.orphanedEvents).then(function(a){return d.applyOrphanedEvents(e.messages,a)}).then(function(){return f=e.earliestEventId-1,d._orphanedEventManager.setContinuationToken(a,f)}).then(function(){return Promise.resolve({continuationToken:f,earliestEventId:e.earliestEventId,latestEventId:e.latestEventId,messages:e.messages})})})},a.prototype.getOrphanedEvents=function(a,b){var c=this,d=b.map(function(a){return c.mapOrphanedEvent(a)});return h.Utils.eachSeries(d,function(a){return c._orphanedEventManager.addOrphanedEvent(a)}).then(function(b){return c._orphanedEventManager.getOrphanedEvents(a)})},a.prototype.markMessagesAsDelivered=function(a,b,c){for(var d=[],e=0,f=b;e<f.length;e++){var g=f[e];if(g.context&&g.context.from&&g.context.from.id!==c){var h=!1;g.statusUpdates&&g.statusUpdates[c]&&("delivered"!==g.statusUpdates[c].status&&"read"!==g.statusUpdates[c].status||(h=!0)),h||d.unshift(g.id)}}if(d.length>0){var i={messageIds:d,status:"delivered",timestamp:(new Date).toISOString()};return this._messageManager.sendMessageStatusUpdates(a,[i])}return Promise.resolve("OK")},a.prototype.resetConversation=function(a){return this._orphanedEventManager.clear(a)},a.prototype.applyOrphanedEvents=function(a,b){var c=this;return h.Utils.eachSeries(b,function(b){return c.playEvent(b,a)?(c._logger.log("succesfuly played event "+b.conversationEventId),c._orphanedEventManager.removeOrphanedEvent(b)):(c._logger.warn("failed to play event "+b.conversationEventId,b),Promise.resolve(!1))})},a.prototype.playEvent=function(a,b){var c,d=!1,e=b.filter(function(b){return b.id===a.payload.messageId});switch(1===e.length?(c=e[0],d=!0):e.length>=1?this._logger.error("Found more than 1 message with same messageId: "+a.payload.messageId):this._logger.log("Message "+a.payload.messageId+" not found ..."),a.name){case"conversationMessage.read":c&&(c.statusUpdates[a.payload.profileId]={status:"read",on:a.payload.timestamp});break;case"conversationMessage.delivered":if(c){var f=c.statusUpdates[a.payload.profileId];f&&"read"===f.status?this._logger.log("Message already marked as read, not marking as delivered"):c.statusUpdates[a.payload.profileId]={status:"delivered",on:a.payload.timestamp}}break;default:this._logger.error("Unknown eventName "+a.name+" for messageId: "+a.payload.messageId)}return d},a.prototype.mapOrphanedEvent=function(a){var b={};return b.conversationEventId=a.id,b.name="conversationMessage."+a.data.name,b.eventId=a.data.eventId,b.conversationId=a.data.payload.conversationId,b.payload=a.data.payload,b},a}();j=d([g.injectable(),f(0,g.inject(i.INTERFACE_SYMBOLS.Logger)),f(1,g.inject(i.INTERFACE_SYMBOLS.LocalStorageData)),f(2,g.inject(i.INTERFACE_SYMBOLS.MessageManager)),f(3,g.inject(i.INTERFACE_SYMBOLS.OrphanedEventManager)),e("design:paramtypes",[Object,Object,Object,Object])],j),b.MessagePager=j},function(a,b,c){"use strict";var d=this&&this.__decorate||function(a,b,c,d){var e,f=arguments.length,g=f<3?b:null===d?d=Object.getOwnPropertyDescriptor(b,c):d;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)g=Reflect.decorate(a,b,c,d);else for(var h=a.length-1;h>=0;h--)(e=a[h])&&(g=(f<3?e(g):f>3?e(b,c,g):e(b,c))||g);return f>3&&g&&Object.defineProperty(b,c,g),g},e=this&&this.__metadata||function(a,b){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(a,b)},f=this&&this.__param||function(a,b){return function(c,d){b(c,d,a)}};Object.defineProperty(b,"__esModule",{value:!0});var g=c(13),h=c(11),i=function(){function a(a,b,c,d,e){this._networkManager=a,this._conversationManager=b,this._messageManager=c,this._messagePager=d,this._contentManager=e}return a.prototype.createConversation=function(a){var b=this;return this._networkManager.ensureSessionAndSocket().then(function(c){return b._conversationManager.createConversation(a)})},a.prototype.updateConversation=function(a,b){var c=this;return this._networkManager.ensureSessionAndSocket().then(function(d){return c._conversationManager.updateConversation(a,b)})},a.prototype.getConversation=function(a){var b=this;return this._networkManager.ensureSessionAndSocket().then(function(c){return b._conversationManager.getConversation(a)})},a.prototype.deleteConversation=function(a){var b=this;return this._networkManager.ensureSessionAndSocket().then(function(c){return b._conversationManager.deleteConversation(a)}).then(function(c){return b._messagePager.resetConversation(a)})},a.prototype.addParticipantsToConversation=function(a,b){var c=this;return this._networkManager.ensureSessionAndSocket().then(function(d){return c._conversationManager.addParticipantsToConversation(a,b)})},a.prototype.deleteParticipantsFromConversation=function(a,b){var c=this;return this._networkManager.ensureSessionAndSocket().then(function(d){return c._conversationManager.deleteParticipantsFromConversation(a,b)})},a.prototype.getParticipantsInConversation=function(a){var b=this;return this._networkManager.ensureSessionAndSocket().then(function(c){return b._conversationManager.getParticipantsInConversation(a)})},a.prototype.getConversations=function(a,b){var c=this;return this._networkManager.ensureSessionAndSocket().then(function(d){return c._conversationManager.getConversations(a,b)})},a.prototype.getConversationEvents=function(a,b,c){var d=this;return this._networkManager.ensureSessionAndSocket().then(function(e){return d._messageManager.getConversationEvents(a,b,c)})},a.prototype.sendMessageToConversation=function(a,b){var c=this;return this._networkManager.ensureSessionAndSocket().then(function(d){return c._messageManager.sendMessageToConversation(a,b)})},a.prototype.sendMessageStatusUpdates=function(a,b){var c=this;return this._networkManager.ensureSessionAndSocket().then(function(d){return c._messageManager.sendMessageStatusUpdates(a,b)})},a.prototype.getMessages=function(a,b,c){var d,e,f=this;return this._networkManager.ensureSessionAndSocket().then(function(e){return d=e.session.profileId,f._messagePager.getMessages(a,b,c)}).then(function(b){return e=b,f._messagePager.markMessagesAsDelivered(a,b.messages,d)}).then(function(a){return Promise.resolve(e)})},a.prototype.sendIsTyping=function(a){var b=this;return this._networkManager.ensureSessionAndSocket().then(function(c){return b._conversationManager.sendIsTyping(a)})},a.prototype.sendIsTypingOff=function(a){var b=this;return this._networkManager.ensureSessionAndSocket().then(function(c){return b._conversationManager.sendIsTypingOff(a)})},a.prototype.uploadContent=function(a,b){var c=this;return this._networkManager.ensureSessionAndSocket().then(function(d){return c._contentManager.uploadContent(a,b)})},a}();i=d([g.injectable(),f(0,g.inject(h.INTERFACE_SYMBOLS.NetworkManager)),f(1,g.inject(h.INTERFACE_SYMBOLS.ConversationManager)),f(2,g.inject(h.INTERFACE_SYMBOLS.MessageManager)),f(3,g.inject(h.INTERFACE_SYMBOLS.MessagePager)),f(4,g.inject(h.INTERFACE_SYMBOLS.ContentManager)),e("design:paramtypes",[Object,Object,Object,Object,Object])],i),b.AppMessaging=i},function(a,b,c){"use strict";var d=this&&this.__decorate||function(a,b,c,d){var e,f=arguments.length,g=f<3?b:null===d?d=Object.getOwnPropertyDescriptor(b,c):d;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)g=Reflect.decorate(a,b,c,d);else for(var h=a.length-1;h>=0;h--)(e=a[h])&&(g=(f<3?e(g):f>3?e(b,c,g):e(b,c))||g);return f>3&&g&&Object.defineProperty(b,c,g),g},e=this&&this.__metadata||function(a,b){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(a,b)},f=this&&this.__param||function(a,b){return function(c,d){b(c,d,a)}};Object.defineProperty(b,"__esModule",{value:!0});var g=c(13),h=c(6),i=c(11),j=function(){function a(a,b,c){this._networkManager=a,this._localStorage=b,this._profileManager=c}return a.prototype.getProfile=function(a){var b=this;return this._networkManager.ensureSessionAndSocket().then(function(c){return b._profileManager.getProfile(a)})},a.prototype.queryProfiles=function(a){var b=this;return this._networkManager.ensureSessionAndSocket().then(function(c){return b._profileManager.queryProfiles(a)})},a.prototype.updateProfile=function(a,b,c){var d=this;return this._networkManager.ensureSessionAndSocket().then(function(e){return d._profileManager.updateProfile(a,b,c)})},a.prototype.patchProfile=function(a,b,c){var d=this;return this._networkManager.ensureSessionAndSocket().then(function(e){return d._profileManager.patchProfile(a,b,c)})},a.prototype.getMyProfile=function(a){var b=this;return void 0===a&&(a=!0),this._networkManager.ensureSessionAndSocket().then(function(a){return b._profileManager.getProfile(a.session.profileId)}).then(function(c){return a&&b._localStorage.setString("MyProfileETag",h.Utils.getHeaderValue(c.headers,"ETag")),Promise.resolve(c.response)})},a.prototype.updateMyProfile=function(a,b){var c=this;return void 0===b&&(b=!0),this._networkManager.ensureSessionAndSocket().then(function(d){return c._profileManager.updateProfile(d.session.profileId,a,b?c._localStorage.getString("MyProfileETag"):void 0)}).then(function(a){return b&&c._localStorage.setString("MyProfileETag",h.Utils.getHeaderValue(a.headers,"ETag")),Promise.resolve(a.response)})},a.prototype.patchMyProfile=function(a,b){var c=this;return this._networkManager.ensureSessionAndSocket().then(function(d){return c._profileManager.patchProfile(d.session.profileId,a,b?c._localStorage.getString("MyProfileETag"):void 0)}).then(function(a){return b&&c._localStorage.setString("MyProfileETag",h.Utils.getHeaderValue(a.headers,"ETag")),Promise.resolve(a.response)})},a}();j=d([g.injectable(),f(0,g.inject(i.INTERFACE_SYMBOLS.NetworkManager)),f(1,g.inject(i.INTERFACE_SYMBOLS.LocalStorageData)),f(2,g.inject(i.INTERFACE_SYMBOLS.ProfileManager)),e("design:paramtypes",[Object,Object,Object])],j),b.Profile=j},function(a,b,c){"use strict";var d=this&&this.__decorate||function(a,b,c,d){var e,f=arguments.length,g=f<3?b:null===d?d=Object.getOwnPropertyDescriptor(b,c):d;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)g=Reflect.decorate(a,b,c,d);else for(var h=a.length-1;h>=0;h--)(e=a[h])&&(g=(f<3?e(g):f>3?e(b,c,g):e(b,c))||g);return f>3&&g&&Object.defineProperty(b,c,g),g},e=this&&this.__metadata||function(a,b){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(a,b)},f=this&&this.__param||function(a,b){return function(c,d){b(c,d,a)}};Object.defineProperty(b,"__esModule",{value:!0});var g=c(13),h=c(11),i=function(){function a(a,b){this._appMessaging=a,this._profile=b}return Object.defineProperty(a.prototype,"appMessaging",{get:function(){return this._appMessaging},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"profile",{get:function(){return this._profile},enumerable:!0,configurable:!0}),a}();i=d([g.injectable(),f(0,g.inject(h.INTERFACE_SYMBOLS.AppMessaging)),f(1,g.inject(h.INTERFACE_SYMBOLS.Profile)),e("design:paramtypes",[Object,Object])],i),b.Services=i},function(a,b,c){"use strict";var d=this&&this.__decorate||function(a,b,c,d){var e,f=arguments.length,g=f<3?b:null===d?d=Object.getOwnPropertyDescriptor(b,c):d;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)g=Reflect.decorate(a,b,c,d);else for(var h=a.length-1;h>=0;h--)(e=a[h])&&(g=(f<3?e(g):f>3?e(b,c,g):e(b,c))||g);return f>3&&g&&Object.defineProperty(b,c,g),g},e=this&&this.__metadata||function(a,b){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(a,b)},f=this&&this.__param||function(a,b){return function(c,d){b(c,d,a)}};Object.defineProperty(b,"__esModule",{value:!0});var g=c(13),h=c(11),i=function(){function a(a,b){this._networkManager=a,this._deviceManager=b}return a.prototype.setFCMPushDetails=function(a,b){var c=this;return this._networkManager.ensureSessionAndSocket().then(function(d){return c._deviceManager.setFCMPushDetails(d.session.id,a,b)})},a.prototype.setAPNSPushDetails=function(a,b,c){var d=this;return this._networkManager.ensureSessionAndSocket().then(function(e){return d._deviceManager.setAPNSPushDetails(e.session.id,a,b,c)})},a.prototype.removePushDetails=function(){var a=this;return this._networkManager.ensureSessionAndSocket().then(function(b){return a._deviceManager.removePushDetails(b.session.id)})},a}();i=d([g.injectable(),f(0,g.inject(h.INTERFACE_SYMBOLS.NetworkManager)),f(1,g.inject(h.INTERFACE_SYMBOLS.DeviceManager)),e("design:paramtypes",[Object,Object])],i),b.Device=i},function(a,b,c){"use strict";var d=this&&this.__decorate||function(a,b,c,d){var e,f=arguments.length,g=f<3?b:null===d?d=Object.getOwnPropertyDescriptor(b,c):d;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)g=Reflect.decorate(a,b,c,d);else for(var h=a.length-1;h>=0;h--)(e=a[h])&&(g=(f<3?e(g):f>3?e(b,c,g):e(b,c))||g);return f>3&&g&&Object.defineProperty(b,c,g),g},e=this&&this.__metadata||function(a,b){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(a,b)},f=this&&this.__param||function(a,b){return function(c,d){b(c,d,a)}};Object.defineProperty(b,"__esModule",{value:!0});var g=c(13),h=c(11),i=function(){function a(a,b){this._networkManager=a,this._facebookManager=b}return a.prototype.createFbOptInState=function(a){var b=this;return this._networkManager.ensureSessionAndSocket().then(function(c){return b._facebookManager.createSendToMessengerState(a)})},a}();i=d([g.injectable(),f(0,g.inject(h.INTERFACE_SYMBOLS.NetworkManager)),f(1,g.inject(h.INTERFACE_SYMBOLS.FacebookManager)),e("design:paramtypes",[Object,Object])],i),b.Channels=i},function(a,b,c){"use strict";var d=this&&this.__decorate||function(a,b,c,d){var e,f=arguments.length,g=f<3?b:null===d?d=Object.getOwnPropertyDescriptor(b,c):d
;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)g=Reflect.decorate(a,b,c,d);else for(var h=a.length-1;h>=0;h--)(e=a[h])&&(g=(f<3?e(g):f>3?e(b,c,g):e(b,c))||g);return f>3&&g&&Object.defineProperty(b,c,g),g};Object.defineProperty(b,"__esModule",{value:!0});var e=c(13),f=function(){function a(){}return a.prototype.conversationDeleted=function(a){return{conversationId:a.conversationId,createdBy:a.context.createdBy,timestamp:a.publishedOn}},a.prototype.conversationUndeleted=function(a){return{conversationId:a.conversationId,createdBy:a.context.createdBy,timestamp:a.publishedOn}},a.prototype.conversationUpdated=function(a){return{conversationId:a.conversationId,createdBy:a.context.createdBy,description:a.payload.description,eTag:a.etag,isPublic:a.payload.isPublic,name:a.payload.name,roles:a.payload.roles,timestamp:a.publishedOn}},a.prototype.participantAdded=function(a){return{conversationId:a.conversationId,createdBy:a.context.createdBy,profileId:a.payload.profileId,role:a.payload.role,timestamp:a.publishedOn}},a.prototype.participantRemoved=function(a){return{conversationId:a.conversationId,createdBy:a.context.createdBy,profileId:a.payload.profileId,timestamp:a.publishedOn}},a.prototype.participantTyping=function(a){return{conversationId:a.payload.conversationId,createdBy:a.context.createdBy,profileId:a.payload.profileId,timestamp:a.publishedOn}},a.prototype.participantTypingOff=function(a){return{conversationId:a.payload.conversationId,createdBy:a.context.createdBy,profileId:a.payload.profileId,timestamp:a.publishedOn}},a.prototype.conversationMessageSent=function(a){return{conversationEventId:a.conversationEventId,conversationId:a.payload.context.conversationId,eventId:a.eventId,name:"conversationMessage.sent",payload:{alert:a.payload.alert,context:a.payload.context,messageId:a.payload.messageId,metadata:a.payload.metadata,parts:a.payload.parts}}},a.prototype.conversationMessageRead=function(a){return{conversationEventId:a.conversationEventId,conversationId:a.payload.conversationId,eventId:a.eventId,name:"conversationMessage.read",payload:{conversationId:a.payload.conversationId,messageId:a.payload.messageId,profileId:a.payload.profileId,timestamp:a.payload.timestamp}}},a.prototype.conversationMessageDelivered=function(a){return{conversationEventId:a.conversationEventId,conversationId:a.payload.conversationId,eventId:a.eventId,name:"conversationMessage.delivered",payload:{conversationId:a.payload.conversationId,messageId:a.payload.messageId,profileId:a.payload.profileId,timestamp:a.payload.timestamp}}},a.prototype.profileUpdated=function(a){return{eTag:a.eTag,profile:a.payload}},a}();f=d([e.injectable()],f),b.EventMapper=f},function(a,b,c){"use strict";var d=this&&this.__decorate||function(a,b,c,d){var e,f=arguments.length,g=f<3?b:null===d?d=Object.getOwnPropertyDescriptor(b,c):d;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)g=Reflect.decorate(a,b,c,d);else for(var h=a.length-1;h>=0;h--)(e=a[h])&&(g=(f<3?e(g):f>3?e(b,c,g):e(b,c))||g);return f>3&&g&&Object.defineProperty(b,c,g),g},e=this&&this.__metadata||function(a,b){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(a,b)},f=this&&this.__param||function(a,b){return function(c,d){b(c,d,a)}};Object.defineProperty(b,"__esModule",{value:!0});var g=c(13),h=c(11),i=c(6),j=function(){function a(a,b,c){this._logger=a,this.networkManager=b,this._comapiConfig=c}return a.prototype.uploadContent=function(a,b){var c=this,d=i.Utils.format(this._comapiConfig.foundationRestUrls.content,{apiSpaceId:this._comapiConfig.apiSpaceId,urlBase:this._comapiConfig.urlBase});return this.networkManager.getValidToken().then(function(b){return new Promise(function(e,f){var g=new XMLHttpRequest;g.open("POST",d),g.setRequestHeader("authorization",c.constructAUthHeader(b));var h;if(a.file){var i=new FormData;i.append("file",a.file),h=i}else g.setRequestHeader("Content-Type","application/json"),h=JSON.stringify({data:a.data,name:a.name,type:a.type});g.send(h),g.onload=function(){var a;try{a=JSON.parse(g.responseText),c._logger&&c._logger.log("uploadContent() returned this object: ",a)}catch(a){c._logger&&c._logger.log("uploadContent returned this text: "+g.responseText),f(g.responseText)}200===g.status?e(a):f(a)},g.onerror=function(){f(g.responseText)},g.onabort=function(){f(g.responseText)},g.onprogress=function(a){if(a.lengthComputable){var b=a.loaded/a.total*100;console.log("onprogress: "+b+" %")}}})})},a.prototype.constructAUthHeader=function(a){return"Bearer "+a},a}();j=d([g.injectable(),f(0,g.inject(h.INTERFACE_SYMBOLS.Logger)),f(1,g.inject(h.INTERFACE_SYMBOLS.NetworkManager)),f(2,g.inject(h.INTERFACE_SYMBOLS.ComapiConfig)),e("design:paramtypes",[Object,Object,Object])],j),b.ContentManager=j},function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var c=function(){function a(){}return a.createFromFile=function(b){return(new a).initFromFile(b)},a.createFromBase64=function(b,c,d){return(new a).initFromBase64Data(b,c,d)},a.prototype.initFromFile=function(a){return this.file=a,this},a.prototype.initFromBase64Data=function(a,b,c){return this.data=a,this.name=b,this.type=c,this},a}();b.ContentData=c}]);